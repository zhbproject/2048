if (!window.__require) { window.__require=function t(o,c,i){function n(e,s){if(!c[e]){if(!o[e]){var r=e.split("/");if(r=r[r.length-1],!o[r]){var l="function"==typeof __require&&__require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+e+"'")}}var h=c[e]={exports:{}};o[e][0].call(h.exports,function(t){return n(o[e][1][t]||t)},h,h.exports,t,o,c,i)}return c[e].exports}for(var a="function"==typeof __require&&__require,e=0;e<i.length;e++)n(i[e]);return n}({block:[function(t,o,c){"use strict";cc._RF.push(o,"f9c9c8BwZVOn7BdQ4JshAC8","block");var i=function(t){return t&&t.__esModule?t:{default:t}}(t("colors"));cc.Class({extends:cc.Component,properties:{numberLabel:cc.Label},start:function(){},setNumber:function(t){0==t&&(this.numberLabel.node.active=!1),this.numberLabel.string=t,t in i.default&&(this.node.color=i.default[t])}}),cc._RF.pop()},{colors:"colors"}],colors:[function(t,o,c){"use strict";cc._RF.push(o,"c663c1zfA5B/o/Mn4bbKxRY","colors");var i=[];i[0]=cc.color(198,184,172,255),i[2]=cc.color(235,224,213,255),i[4]=cc.color(234,219,193,255),i[8]=cc.color(240,167,110,255),i[16]=cc.color(244,138,89,255),i[32]=cc.color(245,112,85,255),i[64]=cc.color(245,83,52,255),i[128]=cc.color(234,200,103,255),i[256]=cc.color(234,197,87,255),i[512]=cc.color(234,192,71,255),i[1024]=cc.color(146,208,80,255),i[2048]=cc.color(0,176,240,255),o.exports=i,cc._RF.pop()},{}],game:[function(t,o,c){"use strict";cc._RF.push(o,"fa64cqw90JBWplcPU3/6jpQ","game");var i=[2,4];cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,score:0,blockPrefab:cc.Prefab,gap:20,bg:cc.Node,gameOverNode:cc.Node},start:function(){this.drawBgBlocks(),this.init(),this.addEventHandler()},drawBgBlocks:function(){this.blockSize=(cc.winSize.width-5*this.gap)/4;var t=this.gap+this.blockSize/2,o=this.blockSize;this.positions=[];for(var c=0;c<4;++c){this.positions.push([0,0,0,0]);for(var i=0;i<4;++i){var n=cc.instantiate(this.blockPrefab);n.width=this.blockSize,n.height=this.blockSize,this.bg.addChild(n),n.setPosition(cc.p(t,o)),this.positions[c][i]=cc.p(t,o),t+=this.gap+this.blockSize,n.getComponent("block").setNumber(0)}o+=this.gap+this.blockSize,t=this.gap+this.blockSize/2}},init:function(){if(this.updateScore(0),this.blocks)for(var t=0;t<this.blocks.length;++t)for(var o=0;o<this.blocks[t].length;++o)null!=this.blocks[t][o]&&this.blocks[t][o].destroy();this.data=[],this.blocks=[];for(var c=0;c<4;++c)this.blocks.push([null,null,null,null]),this.data.push([0,0,0,0]);this.addBlock(),this.addBlock(),this.addBlock()},updateScore:function(t){this.score=t,this.scoreLabel.string="\u5206\u6570\uff1a"+t},getEmptyLocations:function(){for(var t=[],o=0;o<this.blocks.length;++o)for(var c=0;c<this.blocks[o].length;++c)null==this.blocks[o][c]&&t.push({x:o,y:c});return t},addBlock:function(){var t=this.getEmptyLocations();if(0==t.length)return!1;var o=t[Math.floor(Math.random()*t.length)],c=o.x,n=o.y,a=this.positions[c][n],e=cc.instantiate(this.blockPrefab);e.width=this.blockSize,e.height=this.blockSize,this.bg.addChild(e),e.setPosition(a);var s=i[Math.floor(Math.random()*i.length)];return e.getComponent("block").setNumber(s),this.blocks[c][n]=e,this.data[c][n]=s,!0},addEventHandler:function(){var t=this;this.bg.on("touchstart",function(o){t.startPoint=o.getLocation()}),this.bg.on("touchend",function(o){t.touchEnd(o)}),this.bg.on("touchcancel",function(o){t.touchEnd(o)})},touchEnd:function(t){this.endPoint=t.getLocation();var o=this.endPoint.sub(this.startPoint);o.mag()>50&&(Math.abs(o.x)>Math.abs(o.y)?o.x>0?this.moveRight():this.moveLeft():o.y>0?this.moveUp():this.moveDown())},checkFail:function(){for(var t=0;t<4;++t)for(var o=0;o<4;++o){var c=this.data[t][o];if(0==c)return!1;if(o>0&&this.data[t][o-1]==c)return!1;if(o<3&&this.data[t][o+1]==c)return!1;if(t>0&&this.data[t-1][o]==c)return!1;if(t<3&&this.data[t+1][o]==c)return!1}return!0},gameOver:function(){this.gameOverNode.active=!0},afterMove:function(t){t&&(this.updateScore(this.score+1),this.addBlock()),this.checkFail()&&this.gameOver()},doMove:function(t,o,c){var i=cc.moveTo(.1,o),n=cc.callFunc(function(){c&&c()});t.runAction(cc.sequence(i,n))},doMerge:function(t,o,c,i){t.destroy();var n=cc.scaleTo(.1,1.1),a=cc.scaleTo(.1,1),e=cc.callFunc(function(){o.getComponent("block").setNumber(c)}),s=cc.callFunc(function(){i&&i()});o.runAction(cc.sequence(n,e,a,s))},moveLeft:function(){var t=this;cc.log("move left");for(var o=!1,c=function c(i,n,a){if(0!=n&&0!=t.data[i][n])if(0==t.data[i][n-1]){var e=t.blocks[i][n],s=t.positions[i][n-1];t.blocks[i][n-1]=e,t.data[i][n-1]=t.data[i][n],t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(e,s,function(){c(i,n-1,a)}),o=!0}else{if(t.data[i][n-1]!=t.data[i][n])return void(a&&a());var r=t.blocks[i][n],l=t.positions[i][n-1];t.data[i][n-1]*=2,t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i][n-1],t.data[i][n-1],function(){a&&a()})}),o=!0}else a&&a()},i=[],n=0;n<4;++n)for(var a=0;a<4;++a)0!=this.data[n][a]&&i.push({x:n,y:a});for(var e=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++e==i.length&&t.afterMove(o)})},moveRight:function(){var t=this;cc.log("move right");for(var o=!1,c=function c(i,n,a){if(3!=n&&0!=t.data[i][n])if(0==t.data[i][n+1]){var e=t.blocks[i][n],s=t.positions[i][n+1];t.blocks[i][n+1]=e,t.data[i][n+1]=t.data[i][n],t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(e,s,function(){c(i,n+1,a)}),o=!0}else{if(t.data[i][n+1]!=t.data[i][n])return void(a&&a());var r=t.blocks[i][n],l=t.positions[i][n+1];t.data[i][n+1]*=2,t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i][n+1],t.data[i][n+1],function(){a&&a()})}),o=!0}else a&&a()},i=[],n=0;n<4;++n)for(var a=3;a>=0;--a)0!=this.data[n][a]&&i.push({x:n,y:a});for(var e=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++e==i.length&&t.afterMove(o)})},moveUp:function(){var t=this;cc.log("move up");for(var o=!1,c=function c(i,n,a){if(3!=i&&0!=t.data[i][n])if(0==t.data[i+1][n]){var e=t.blocks[i][n],s=t.positions[i+1][n];t.blocks[i+1][n]=e,t.data[i+1][n]=t.data[i][n],t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(e,s,function(){c(i+1,n,a)}),o=!0}else{if(t.data[i+1][n]!=t.data[i][n])return void(a&&a());var r=t.blocks[i][n],l=t.positions[i+1][n];t.data[i+1][n]*=2,t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i+1][n],t.data[i+1][n],function(){a&&a()})}),o=!0}else a&&a()},i=[],n=3;n>=0;--n)for(var a=0;a<4;++a)0!=this.data[n][a]&&i.push({x:n,y:a});for(var e=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++e==i.length&&t.afterMove(o)})},moveDown:function(){var t=this;cc.log("move down");for(var o=!1,c=function c(i,n,a){if(0!=i&&0!=t.data[i][n])if(0==t.data[i-1][n]){var e=t.blocks[i][n],s=t.positions[i-1][n];t.blocks[i-1][n]=e,t.data[i-1][n]=t.data[i][n],t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(e,s,function(){c(i-1,n,a)}),o=!0}else{if(t.data[i-1][n]!=t.data[i][n])return void(a&&a());var r=t.blocks[i][n],l=t.positions[i-1][n];t.data[i-1][n]*=2,t.data[i][n]=0,t.blocks[i][n]=null,t.doMove(r,l,function(){t.doMerge(r,t.blocks[i-1][n],t.data[i-1][n],function(){a&&a()})}),o=!0}else a&&a()},i=[],n=0;n<4;++n)for(var a=0;a<4;++a)0!=this.data[n][a]&&i.push({x:n,y:a});for(var e=0,s=0;s<i.length;++s)c(i[s].x,i[s].y,function(){++e==i.length&&t.afterMove(o)})},restart:function(){this.init(),this.gameOverNode.active=!1}}),cc._RF.pop()},{}]},{},["block","colors","game"]);}