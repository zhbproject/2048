window.__require=function e(t,a,i){function n(r,o){if(!a[r]){if(!t[r]){var h=r.split("/");if(h=h[h.length-1],!t[h]){var c="function"==typeof __require&&__require;if(!o&&c)return c(h,!0);if(s)return s(h,!0);throw new Error("Cannot find module '"+r+"'")}}var d=a[r]={exports:{}};t[r][0].call(d.exports,function(e){return n(t[r][1][e]||e)},d,d.exports,e,t,a,i)}return a[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<i.length;r++)n(i[r]);return n}({CircleCheck:[function(e,t,a){"use strict";cc._RF.push(t,"bb834Tu1E1FkYbMOspNroBw","CircleCheck");var i=e("Player"),n=kf.require("basic.clientEvent"),s=kf.require("logic.user");cc.Class({extends:cc.Component,properties:{hostPlayer:i},onLoad:function(){this.radius=.5*this.node.width,this.initWidth=this.node.width,this.initHeight=this.node.height,this.deltaCheckFrame=3,this.curCheckFrame=0},extraLevelUp:function(e){e?this.extraLv+=e:this.extraLv++,this.sizeUpdate(1)},sizeUpdate:function(e,t){var a=dataFunc.getTableArr("level");if(a){var i=this.hostPlayer.playerLv;t?i>4&&(i=4):this.node.x=300+15*i;for(var n=0;n<a.length;n++)if(a[n].level===i||n===a.length-1){this.node.width=a[n].circleRadiusFactor*this.initWidth*e,this.node.height=a[n].circleRadiusFactor*this.initHeight*e;break}}},update:function(e){if(this.hostPlayer&&GameManager.gameState===GameState.Play){this.radius=.5*this.node.width;var t=Math.ceil(FansManager.fans.length/this.deltaCheckFrame),a=t*this.curCheckFrame,i=a+t;i>FansManager.fans.length&&(i=FansManager.fans.length),this.curCheckFrame++,this.curCheckFrame>=this.deltaCheckFrame&&(this.curCheckFrame=0);for(var r=a;r<i;r++){var o=FansManager.fans[r];if(o.hostPlayer){if(o.hostPlayer!==this.hostPlayer&&!o.hostPlayer.getInvincibility()&&this.hostPlayer.getFansAmount()>o.hostPlayer.getFansAmount())if(this.hostPlayer.node.position.sub(o.hostPlayer.node.position).mag()<300&&(o.hostPlayer.eatNowTime-=.005),o.hostPlayer.eatNowTime<0){var h=this.node.position,c=o.node.convertToWorldSpaceAR(cc.v2(0,0)),d=this.node.parent.convertToNodeSpaceAR(c);if(h.sub(d).mag()<this.radius){var l=o.hostPlayer;if(l.removeFan(o),this.hostPlayer.addFan(o),l.getFansAmount()<=0){n.dispatchEvent("killPlayerLogic",{murder:this.hostPlayer,victim:l}),n.dispatchEvent("killPlayerUI",{murder:this.hostPlayer,victim:l});for(var p=0;p<5;p++){var g=FansManager.getFan(this.hostPlayer);this.hostPlayer.addFan(g)}FansManager.addFans10Tip(l,this.hostPlayer);break}this.hostPlayer!==PlayerManager.player&&l!==PlayerManager.player||(s.setAudio("grab"),window.wx&&s.vibrateOn&&wx.vibrateShort()),FansManager.addFansTip(o,this.hostPlayer),this.hostPlayer.node.position.sub(o.hostPlayer.node.position).mag()<200&&(o.hostPlayer.eatNowTime-=.03)}}}else{var m=this.node.position,y=o.node.convertToWorldSpaceAR(cc.v2(0,0)),u=this.node.parent.convertToNodeSpaceAR(y);if(m.sub(u).mag()<this.radius){this.hostPlayer.addFan(o),this.hostPlayer===PlayerManager.player&&(s.setAudio("grab"),window.wx&&s.vibrateOn&&wx.vibrateShort()),FansManager.addFansTip(o,this.hostPlayer);break}}}}}}),cc._RF.pop()},{Player:"Player"}],CircleManager:[function(e,t,a){"use strict";cc._RF.push(t,"b3e648gRPNL8YLO1Gt69g2T","CircleManager"),cc.Class({extends:cc.Component,properties:{circlePrefab:cc.Prefab,circleParent:cc.Node},onLoad:function(){window.CircleManager=this},addCircle:function(e){var t=cc.instantiate(this.circlePrefab);t.parent=this.circleParent,t.getComponent("Follow").target=e.node;var a=t.getComponent("CircleCheck");return a.hostPlayer=e,a}}),cc._RF.pop()},{}],FansManager:[function(e,t,a){"use strict";cc._RF.push(t,"c0a0fz4Za5F+YOAXuS9AGOz","FansManager"),cc.Class({extends:cc.Component,properties:{fanPrefab:cc.Prefab,fanParent:cc.Node,addTip:cc.Prefab,addFansTipParent:cc.Node,lightRing:cc.Prefab,addFansTipRingParent:cc.Node},onLoad:function(){window.FansManager=this},start:function(){this.fans=[],this.addTipLbPool=new cc.NodePool,this.addTipRingPool=new cc.NodePool,setTimeout(function(){this.generateFansRandomInterval()}.bind(this),500)},getFan:function(e){if(this.isValid){var t=cc.instantiate(this.fanPrefab);if(t.parent=this.fanParent,t.scale=.5,window.ShadowManager&&ShadowManager.addShadow(t),e){var a=e.node.convertToWorldSpaceAR(cc.v2(0,0)),i=this.fanParent.convertToNodeSpaceAR(a);t.position=i}var n=t.getComponent("fan");return this.fans.push(n),n}},addFansTip:function(e,t){t===PlayerManager.player&&this.addFansLbTip(e,t),this.addFansRingTip(e,t)},addFans10Tip:function(e,t){if(t===PlayerManager.player){var a=cc.instantiate(this.addTip);a.parent=this.addFansTipParent;var i=a.children[0].getComponent(cc.Label);i.node.color=t.uiColor,i.fontSize=100,i.lineHeight=120,i.string=",5";var n=e.node.convertToWorldSpaceAR(cc.v2(0,0)),s=this.addFansTipParent.convertToNodeSpaceAR(n);a.position=s;var r=a.getComponent(cc.Animation);r&&r.play(),setTimeout(function(){this.isValid&&a.destroy()}.bind(this),5e3)}},addFansLbTip:function(e,t){var a=this.addTipLbPool.get();a||(a=cc.instantiate(this.addTip)),a.parent=this.addFansTipParent,a.children[0].color=t.uiColor;var i=e.node.convertToWorldSpaceAR(cc.v2(0,0)),n=this.addFansTipParent.convertToNodeSpaceAR(i);a.position=n;var s=a.getComponent(cc.Animation);s&&s.play(),setTimeout(function(){this&&this.addTipLbPool&&this.addTipLbPool.put(a)}.bind(this),5e3)},addFansRingTip:function(e,t){var a=this.addTipRingPool.get();a||(a=cc.instantiate(this.lightRing)),a.parent=this.addFansTipRingParent;for(var i=0;i<a.children.length;i++){a.children[i].color=t.uiColor;for(var n=0;n<a.children[i].children.length;n++)a.children[i].children[n].color=t.uiColor}var s=a.getComponent("Follow");s&&(s.target=e.node);var r=a.getComponent(cc.Animation);r&&r.play(),setTimeout(function(){this&&this.addTipRingPool&&this.addTipRingPool.put(a)}.bind(this),5e3)},generateFansRandomInterval:function(){var e=this,t=.5*-GameManager.BoundSize.x,a=.5*GameManager.BoundSize.x,i=.5*-GameManager.BoundSize.y,n=.5*GameManager.BoundSize.y,s=0,r=200,o=5;if(GameManager.SystemInfo&&"android"===GameManager.SystemInfo.platform&&GameManager.SystemInfo.benchmarkLevel){var h=dataFunc.queryOne("benchmarkLevel","benchmarkLevel",GameManager.SystemInfo.benchmarkLevel);h&&(r=h.initFanCnt,o=h.deltaSpawnFanCnt)}var c=setInterval(function(){if(e.isValid){var o=FansManager.getFan();if(o){var h=cc.v2((a-t)*(Math.random()-.5),(n-i)*(Math.random()-.5)),d=ObstaclesManager.detectIfInObstacle(h);d&&(h=d),o.node.x=h.x,o.node.y=h.y}++s>r&&clearInterval(c)}else clearInterval(c)},5),d=0,l=a-t,p=0,g=kf.require("basic.configuration").getConfigData("roundCnt");g=g?parseInt(g):1;var m=dataFunc.queryOne("newbieProtectTplt","round",g);m&&(d=m.fanCnt,l=2*m.range,p=m.durTime),this.fanSpawnId=setInterval(function(){if(GameManager.gameState===GameState.Play){for(var e=0;e<o;e++){if(!this.isValid)return void clearInterval(this.fanSpawnId);var s=this.getFan();if(s){var r=cc.v2(0,0);if(e<d&&p>0){if(PlayerManager.player){var h=PlayerManager.player.node.x+(Math.random()-.5)*l;h>a?h=a:h<t&&(h=t);var c=PlayerManager.player.node.y+(Math.random()-.5)*l;c>n?c=n:c<i&&(c=i),r=cc.v2(h,c)}}else{r=cc.v2((a-t)*(Math.random()-.5),(n-i)*(Math.random()-.5));var g=ObstaclesManager.detectIfInObstacle(r);g&&(r=g)}s.node.x=r.x,s.node.y=r.y}}p-=1}}.bind(this),1e3)},onDestroy:function(){clearInterval(this.fanSpawnId)}}),cc._RF.pop()},{}],Follow:[function(e,t,a){"use strict";cc._RF.push(t,"5c4dfSefoVJDo/n0g/nkfyh","Follow"),cc.Class({extends:cc.Component,properties:{target:{default:null,type:cc.Node},offset:cc.Vec2,isSpring:!1},setPosImmediately:function(){if(this.target){var e=this.target.convertToWorldSpaceAR(cc.v2(0,0)),t=this.node.parent.convertToNodeSpaceAR(e);this.node.x=t.x+this.offset.x,this.node.y=t.y+this.offset.y}},lateUpdate:function(e){if(this.target){var t=this.target.convertToWorldSpaceAR(cc.v2(0,0)),a=this.node.parent.convertToNodeSpaceAR(t);this.isSpring?(this.node.x=cc.lerp(this.node.x,a.x+this.offset.x,4*e),this.node.y=cc.lerp(this.node.y,a.y+this.offset.y,4*e)):(this.node.x=a.x+this.offset.x,this.node.y=a.y+this.offset.y)}}}),cc._RF.pop()},{}],Game:[function(e,t,a){"use strict";cc._RF.push(t,"e98e7hxETxODLM8wGu55+mC","Game");var i=e("JoystickCommon"),n=e("JoystickBG"),s=kf.require("basic.clientEvent");cc.Class({extends:cc.Component,properties:{dot:{default:null,type:cc.Node,displayName:"\u6447\u6746\u8282\u70b9"},ring:{default:null,type:n,displayName:"\u6447\u6746\u80cc\u666f\u8282\u70b9"},stickX:{default:0,displayName:"\u6447\u6746X\u4f4d\u7f6e"},stickY:{default:0,displayName:"\u6447\u6746Y\u4f4d\u7f6e"},touchType:{default:i.TouchType.DEFAULT,type:i.TouchType,displayName:"\u89e6\u6478\u7c7b\u578b"},directionType:{default:i.DirectionType.ALL,type:i.DirectionType,displayName:"\u65b9\u5411\u7c7b\u578b"},sprite:{default:null,type:cc.Node,displayName:"\u64cd\u63a7\u7684\u76ee\u6807"},_stickPos:{default:null,type:cc.Node,displayName:"\u6447\u6746\u5f53\u524d\u4f4d\u7f6e"},_touchLocation:{default:null,type:cc.Node,displayName:"\u6447\u6746\u5f53\u524d\u4f4d\u7f6e"}},onLoad:function(){this._createStickSprite(),this.touchType==i.TouchType.FOLLOW&&this._initTouchEvent()},_createStickSprite:function(){this.ring.node.setPosition(this.stickX,this.stickY),this.dot.setPosition(this.stickX,this.stickY)},_initTouchEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStartEvent,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMoveEvent,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEndEvent,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEndEvent,this)},_touchStartEvent:function(e){GameManager.touchStart=!0,s.dispatchEvent("_touchStartEvent"),this._touchLocation=e.getLocation();var t=this.node.convertToNodeSpaceAR(e.getLocation());this.ring.node.setPosition(t),this.dot.setPosition(t),this._stickPos=t},_touchMoveEvent:function(e){if(this._touchLocation.x==e.getLocation().x&&this._touchLocation.y==e.getLocation().y)return!1;var t=this.ring.node.convertToNodeSpaceAR(e.getLocation()),a=this.ring._getDistance(t,cc.v2(0,0)),i=this.ring.node.width/2,n=this._stickPos.x+t.x,s=this._stickPos.y+t.y;if(i>a)this.dot.setPosition(cc.v2(n,s));else{var r=this._stickPos.x+Math.cos(this.ring._getRadian(cc.v2(n,s)))*i,o=this._stickPos.y+Math.sin(this.ring._getRadian(cc.v2(n,s)))*i;this.dot.setPosition(cc.v2(r,o))}this.ring._getAngle(cc.v2(n,s)),this.ring._setSpeed(cc.v2(n,s))},_touchEndEvent:function(){this.dot.setPosition(this.ring.node.getPosition()),this.ring._speed=0}}),cc._RF.pop()},{JoystickBG:"JoystickBG",JoystickCommon:"JoystickCommon"}],JoystickBG:[function(e,t,a){"use strict";cc._RF.push(t,"db0f2FiBgtK4rT6reD2+4vr","JoystickBG");var i=e("JoystickCommon");cc.Class({extends:cc.Component,properties:{dot:{default:null,type:cc.Node,displayName:"\u6447\u6746\u8282\u70b9"},_joyCom:{default:null,displayName:"joy Node"},_playerNode:{default:null,displayName:"\u88ab\u64cd\u4f5c\u7684\u76ee\u6807Node"},_angle:{default:null,displayName:"\u5f53\u524d\u89e6\u6478\u7684\u89d2\u5ea6"},_radian:{default:null,displayName:"\u5f27\u5ea6"},_speed:0,_speed1:8,_speed2:10,_opacity:0},onLoad:function(){this._joyCom=this.node.parent.getComponent("Game"),this._playerNode=this._joyCom.sprite,this._joyCom.touchType==i.TouchType.DEFAULT&&this._initTouchEvent()},start:function(){GameManager.Joystick=this},_initTouchEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._touchStartEvent,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMoveEvent,this),this.node.on(cc.Node.EventType.TOUCH_END,this._touchEndEvent,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEndEvent,this)},update:function(e){switch(this._joyCom.directionType){case i.DirectionType.ALL:this._allDirectionsMove(e)}},_allDirectionsMove:function(e){if(GameManager.gameState===GameState.Play&&PlayerManager.player.node.active&&(this._speed=PlayerManager.player.speed,null!==this._angle&&void 0!==this._angle)){var t=Math.cos(this._angle*(Math.PI/180))*this._speed,a=Math.sin(this._angle*(Math.PI/180))*this._speed;this._playerNode.x+=t*e,this._playerNode.y+=a*e}},_getDistance:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},_getRadian:function(e){return this._radian=Math.PI/180*this._getAngle(e),this._radian},_getAngle:function(e){var t=this.node.getPosition();return this._angle=Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI),this._angle},_setSpeed:function(e){this._getDistance(e,this.node.getPosition())<this._radius?this._speed=this._speed1:this._speed=this._speed2},_touchStartEvent:function(e){var t=this.node.convertToNodeSpaceAR(e.getLocation()),a=this._getDistance(t,cc.v2(0,0)),i=this.node.width/2;this._stickPos=t;var n=this.node.getPosition().x+t.x,s=this.node.getPosition().y+t.y;return i>a&&(this.dot.setPosition(cc.v2(n,s)),!0)},_touchMoveEvent:function(e){var t=this.node.convertToNodeSpaceAR(e.getLocation()),a=this._getDistance(t,cc.v2(0,0)),i=this.node.width/2,n=this.node.getPosition().x+t.x,s=this.node.getPosition().y+t.y;if(i>a)this.dot.setPosition(cc.v2(n,s));else{var r=this.node.getPosition().x+Math.cos(this._getRadian(cc.v2(n,s)))*i,o=this.node.getPosition().y+Math.sin(this._getRadian(cc.v2(n,s)))*i;this.dot.setPosition(cc.v2(r,o))}this._getAngle(cc.v2(n,s)),this._setSpeed(cc.v2(n,s))},_touchEndEvent:function(){this.dot.setPosition(this.node.getPosition()),this._speed=0}}),cc._RF.pop()},{JoystickCommon:"JoystickCommon"}],JoystickCommon:[function(e,t,a){"use strict";cc._RF.push(t,"2f218v14+5ApY52tiPQqn49","JoystickCommon"),t.exports={TouchType:cc.Enum({DEFAULT:0,FOLLOW:1}),DirectionType:cc.Enum({FOUR:4,EIGHT:8,ALL:0})},cc._RF.pop()},{}],ObstaclesManager:[function(e,t,a){"use strict";cc._RF.push(t,"f26ddAdJKVEKJ/amCf8bRX0","ObstaclesManager"),cc.Class({extends:cc.Component,properties:{obstacle:cc.Node,topUIObstacle:cc.Node,baseUIObstacle:cc.Node,world:cc.Node},onLoad:function(){window.ObstaclesManager=this,this.fanWidht=152,this.fanHeight=246,ObstaclesManager.rectObstacles=this.obstacle.children,kf.require("logic.user").underReview&&(this.topUIObstacle.active=!1,this.baseUIObstacle.active=!1,this.obstacle.active=!1,this.world.active=!1,ObstaclesManager.rectObstacles=[])},detectIfInObstacle:function(e){if(PlayerManager.player){for(var t=ObstaclesManager.fanWidht*PlayerManager.player.node.scale*.6,a=ObstaclesManager.fanHeight*PlayerManager.player.node.scale*.35,i=0;i<ObstaclesManager.rectObstacles.length;i++){var n=ObstaclesManager.rectObstacles[i],s=n.y+.5*(n.height+a);if(!(e.y>s)){var r=n.y-.5*(n.height+a);if(!(e.y<r)){var o=n.x-.5*(n.width+t);if(!(e.x<o)){var h=n.x+.5*(n.width+t);if(!(e.x>h)){var c=e.x-o>h-e.x?h:o,d=e.y-r>s-e.y?s:r;return Math.abs(c-e.x)>Math.abs(d-e.y)?cc.v2(e.x,d):cc.v2(c,e.y)}}}}}return!1}}}),cc._RF.pop()},{}],PlayerManager:[function(e,t,a){"use strict";cc._RF.push(t,"8dc6e0xzzxLDbyfMrUP9bCH","PlayerManager");var i=kf.require("logic.user");cc.Class({extends:cc.Component,properties:{playerParent:cc.Node,playerPrefab:cc.Prefab,arrowTrackParent:cc.Node,nameTrackParent:cc.Node,arrowPrefab:cc.Prefab,nameTrackPrefab:cc.Prefab,namePrefab:cc.Prefab,nameParent:cc.Node,fanCntUIParent:cc.Node,fanCntPrefab:cc.Prefab,speedUpUIPrefab:cc.Prefab,world:cc.Node,fansParent:[cc.Node],crown:cc.Node,spawnPos:[cc.Vec2],speedEffect:cc.Prefab},getWorldScale:function(){return this.world.scale},onLoad:function(){window.PlayerManager=this,this.loadPlayerInfo()},loadPlayerInfo:function(){Array.prototype.shuffle=function(){for(var e=this.length,t=void 0,a=void 0;e;)a=Math.floor(Math.random()*e--),t=this[e],this[e]=this[a],this[a]=t;return this},this.spawnPos.shuffle(),PlayerManager.PlayersInfo=[];var e=dataFunc.queryOne("growUpLevel","level",i.playerLevel);if(e){var t=[].concat(dataFunc.getTableArr("nickName"));i.underReview&&(t=[{nickName:"\u5f20\u4e09"},{nickName:"\u674e\u56db"},{nickName:"\u4f46\u613f\u4eba\u957f\u4e45"},{nickName:"\u897f\u74dc"},{nickName:"\u5c0f\u660e"},{nickName:"\u5c0f\u7f8e"},{nickName:"\u5eb7\u5eb7"},{nickName:"\u9ea6\u514b"},{nickName:"\u54c8\u54c8"}]);for(var a=PlayerManager.getSkinTemplate(8,i.skinId),n=dataFunc.queryOne("AILevel","level",GameManager.AILevel),s=PlayerManager.getPlayerFansCnt(n),r=0;r<8;r++)if(0===r)PlayerManager.PlayersInfo.push({nickName:i.playerName,skinId:a[r].ID,level:i.data.gameData.playerLevel,position:this.spawnPos[r],reviveCd:0,reviveVipRate:0,propFailCd:0,propUseRate:0,propUseTimeDelay:0,propUseTotalCnt:0,isAI:!1});else{var o=dataFunc.randomNum(0,t.length-1),h=dataFunc.randomNum(e.minAILv,e.maxAILv),c=t[o];PlayerManager.PlayersInfo.push({nickName:c.nickName,skinId:a[r].ID,level:h,position:this.spawnPos[r],initFansCnt:s.shift(),reviveCd:n.reviveCd,reviveVipRate:n.reviveVipRate,propFailCd:n.propFailCd,propUseRate:n.propUseRate,propUseTimeDelay:n.propUseTimeDelay,propUseTotalCnt:n.propUseTotalCnt,isAI:!0}),t.splice(o,1)}}else console.warn("playerLevel is nil:"+i.playerLevel)},getPlayerFansCnt:function(e){var t=.1,a=.2;e&&(t=e.fans20Rate,a=e.fans10Rate,e.fans1Rate);for(var i=[];i.length<7;){var n=Math.random(),s=dataFunc.randomNum(e.minExtraFans,e.maxExtraFans);n<t?i.push(20+s):n<t+a?i.push(10+s):i.push(1+s)}return i},getSkinTemplate:function(e,t){var a=[],i=dataFunc.queryByID("skin",t);a.push(i);for(var n=[].concat(dataFunc.getTableArr("skin")),s=7;a.length<e;)if(a.length<4){var r=dataFunc.randomNum(0,s),o=n[r];o.ID!==t&&(a.push(o),n.splice(r,1),s--)}else{var h=dataFunc.randomNum(0,n.length-1),c=n[h];c.ID!==t&&(a.push(c),n.splice(h,1))}return a},start:function(){PlayerManager.players=[];for(var e=1;e<8;e++){var t=cc.instantiate(this.playerPrefab);t.parent=this.playerParent;var a=t.getComponent("Player");a.fansParent=this.fansParent[e],a.setData(this.PlayersInfo[e]);var i=cc.instantiate(this.arrowPrefab);i.parent=this.arrowTrackParent,i.getComponent("enemyPosArrow").setHostPlayer(a);var n=cc.instantiate(this.nameTrackPrefab);n.parent=this.nameTrackParent,n.getComponent("enemyPosName").setHostPlayer(a),PlayerManager.players.push(a)}},addSpeedUpUI:function(e){var t=cc.instantiate(this.speedUpUIPrefab);t.parent=this.fanCntUIParent;var a=t.getComponent("Follow");return a.target=e.node,a.setPosImmediately(),t},addSpeedEffect:function(e){var t=cc.instantiate(this.speedEffect);return t.parent=e.node,t},speedUp:function(e){var t=kf.require("shared.constants");PlayerManager.player&&PlayerManager.player.speedUp&&(PlayerManager.player.speedUp(e),e===t.speedType.gold?window.wx&&wx.showToast({title:"\u79fb\u52a8\u901f\u5ea6\u63d0\u9ad8\u4e86"+(t.speedGoldAddPra-100)+"%",icon:"none",duration:1500}):window.wx&&wx.showToast({title:"\u79fb\u52a8\u901f\u5ea6\u63d0\u9ad8\u4e8630%",icon:"none",duration:1500}))},changeAllAIStrategy:function(){var e=kf.require("basic.configuration").getConfigData("roundCnt");if(e=e?parseInt(e):1,!dataFunc.queryOne("newbieProtectTplt","round",e)){for(var t=0;PlayerManager.players&&t<PlayerManager.players.length;t++)PlayerManager.players[t].lastAIStrategy=PlayerManager.players[t].aiStrategy,PlayerManager.players[t].lastDangerDetectDistance=PlayerManager.players[t].dangerDetectDistance,PlayerManager.players[t].aiStrategy=AIStrategy.Crazy,PlayerManager.players[t].dangerDetectDistance=200;setTimeout(function(){if(window.PlayerManager&&PlayerManager.players)for(var e=0;e<PlayerManager.players.length;e++)PlayerManager.players[e].aiStrategy=PlayerManager.players[e].lastAIStrategy,PlayerManager.players[e].dangerDetectDistance=PlayerManager.players[e].lastDangerDetectDistance},3e4)}},magnet:function(){PlayerManager.player.circleChecker.extraLevelUp(3),window.wx&&wx.showToast({title:"\u811a\u4e0b\u7684\u5438\u6536\u5708\u6269\u5927\u4e863\u7ea7",icon:"none",duration:1500})},doubleFan:function(){for(var e=PlayerManager.player.getFansAmount(),t=0;t<e;t++){var a=FansManager.getFan();PlayerManager.player.addFan(a),a.node.position=PlayerManager.player.node.position}window.wx&&wx.showToast({title:"\u4eba\u6570\u7ffb\u500d\u4e86",icon:"none",duration:1500})},addName:function(e){var t=cc.instantiate(this.namePrefab);t.parent=this.nameParent;var a=t.getComponent(cc.Label);a&&(a.string=e.playerName,a.node.color=e.uiColor);var i=t.getComponent("Follow");return i.target=e.node,i.setPosImmediately(),t},addFanCntUI:function(e){var t=cc.instantiate(this.fanCntPrefab);t.parent=this.fanCntUIParent;var a=t.children[0].getComponent(cc.Label);a&&(a.string=e.getFansAmount()),t.color=e.uiColor;var i=t.getComponent("Follow");return i.target=e.node,i.setPosImmediately(),{fansCntLb:a,fansCntBg:t}},update:function(){var e=PlayerManager.player.fans.length/1e3;e>.2&&(e=.2),this.world.scale=.72-e;var t=PlayerManager.players[0];this.crown.parent=t.node,this.crown.setPosition(0,131),this.crown.scale=1}}),cc._RF.pop()},{}],Player:[function(e,t,a){"use strict";cc._RF.push(t,"17726qMl/xFhYRKzsyh/pXy","Player"),window.Direction={Idle:0,Left:1,Right:2,Up:4,LeftUp:5,RightUp:6,Down:8,LeftDown:9,RightDown:10},window.AIStrategy={Crazy:{chaseTime:25,fansDelta:1,detectionRange:2e3},Radical:{chaseTime:15,fansDelta:2,detectionRange:1e3},Calm:{chaseTime:10,fansDelta:8,detectionRange:800},Conservatism:{chaseTime:6,fansDelta:15,detectionRange:600}};var i=kf.require("logic.user"),n=kf.require("basic.clientEvent"),s=[40,80,120,160,200,240,300,340,380,440,480,520,560,600,640,680,720,760,800,840,880,920,960,1e3],r=[2,5,8,12,17,23,30,38,47,57,67,77,87,97,107,117,127,137,147,157,167,177,187,197],o=kf.require("shared.constants"),h=kf.require("basic.configuration");cc.Class({extends:cc.Component,properties:{bodySprite:cc.Sprite,invincibilityTag:cc.Node,fansCircle:cc.Node},onLoad:function(){this.aiStrategy=AIStrategy.Conservatism,this.propUseCnt=0,this.propUseTotalCnt=3,this.killCnt=0,this.isRender=!0,this.playerLv=1,this.maxFansCnt=0,this.direction=Direction.IDLE,this.lastPos=this.node.position,this.goldSpeedNum=0,this.continueKillCnt=0},setData:function(e){var t=this;this.info=e,this.characterLv=e.level,this.reviveCd=e.reviveCd,this.reviveVipRate=e.reviveVipRate,this.propFailCd=e.propFailCd,this.propUseRate=e.propUseRate,this.propUseTimeDelay=e.propUseTimeDelay,this.propUseTotalCnt=e.propUseTotalCnt,this.lvInfo=dataFunc.queryOne("growUpLevel","level",this.characterLv),this.lvInfo?this.initSpeed=this.lvInfo.speed:(this.initSpeed=600,console.log("playerLevel Tplt level:"+this.characterLv+"is nil")),this.node.position=e.position,this.speed=this.initSpeed,this.playerName=e.nickName,this.isAI=e.isAI,this.fans=[];var a=dataFunc.queryByID("skin",e.skinId);if(this.uiColor=cc.color(a.uiColorValue),this.characterColor=cc.color(a.characterColorValue),i.underReview)this.Idle=GameManager.underReviewSkin.Idle,this.Left=GameManager.underReviewSkin.Left,this.Right=GameManager.underReviewSkin.Right,this.Up=GameManager.underReviewSkin.Up,this.LeftUp=GameManager.underReviewSkin.LeftUp,this.RightUp=GameManager.underReviewSkin.RightUp,this.Down=GameManager.underReviewSkin.Down,this.LeftDown=GameManager.underReviewSkin.LeftDown,this.RightDown=GameManager.underReviewSkin.RightDown,this.bodySprite.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.bodySprite.spriteFrame=this.Idle[0],this.anim=this.Idle,this.shadow=ShadowManager.addShadow(this.node);else{var n=this;a?this.isAI?cc.loader.loadRes("skins/"+a.prefabName,cc.Prefab,function(e,a){if(t.isValid){if(!e){var i=cc.instantiate(a).getComponent("skinInfo");i&&(n.Idle=i.Idle,n.Left=i.Left,n.Right=i.Left,n.Up=i.Up,n.LeftUp=i.LeftUp,n.RightUp=i.LeftUp,n.Down=i.Down,n.LeftDown=i.LeftDown,n.RightDown=i.LeftDown)}n.bodySprite.spriteFrame=n.Idle[0],n.anim=n.Idle,n.shadow=ShadowManager.addShadow(t.node)}}):(n.Idle=GameManager.playerSkin.Idle,n.Left=GameManager.playerSkin.Left,n.Right=GameManager.playerSkin.Left,n.Up=GameManager.playerSkin.Up,n.LeftUp=GameManager.playerSkin.LeftUp,n.RightUp=GameManager.playerSkin.LeftUp,n.Down=GameManager.playerSkin.Down,n.LeftDown=GameManager.playerSkin.LeftDown,n.RightDown=GameManager.playerSkin.LeftDown,n.bodySprite.spriteFrame=n.Idle[0],n.anim=n.Idle,n.shadow=ShadowManager.addShadow(this.node)):(n.bodySprite.spriteFrame=n.Idle[0],n.anim=n.Idle,console.warn("skinId:"+skinId+"is nil"))}this.dangerDetectDistance=1e3,this.deltaAnimFrame=.1,this.targetFan=null,this.targetPlayer=null,this.forbiddenFans=[],this.forbiddenPlayers=[],this.clearForbiddenCd=5,this.forbiddenDangers=[],this.clearDangersCd=.5,this.speedUpNowTime=0,this.speedUpMaxTime=20,this.eatNowTime=0,this.eatMaxCd=.05,this.setInvincibility(!1)},start:function(){this.fansCircleCheck=this.fansCircle.getComponent("CircleCheck"),this.fansCircleCheck.sizeUpdate(1.5);var e=1;if(this.info&&(e=this.info.initFansCnt),this.isAI){var t=dataFunc.randomNum(-180,180);this.aiStrategy=t<-90?AIStrategy.Radical:t>90?AIStrategy.Calm:AIStrategy.Conservatism}else e=kf.require("logic.user").superStart,e+=GameManager.miniGameExtraFan,e+=i.fansCountLevel,PlayerManager.player=this,PlayerManager.players.unshift(this),this.fansParent=PlayerManager.fansParent[0],this.setData(PlayerManager.PlayersInfo[0]),this.node.position=PlayerManager.spawnPos[0];this.invincibilityTag.color=this.uiColor,this.bodySprite.node.color=this.characterColor,this.nameNode=PlayerManager.addName(this);var a=PlayerManager.addFanCntUI(this);this.fansCntLb=a.fansCntLb,this.fansCntBg=a.fansCntBg;for(var s=0;s<e;s++){var r=FansManager.getFan();this.addFan(r)}this.setFanPosImmediately(),n.on("killPlayerLogic",this.killPlayerLogic.bind(this)),this.newbieProtect()},newbieProtect:function(){if(this.isAI){var e=h.getConfigData("roundCnt");e=e?parseInt(e):1;var t=dataFunc.queryOne("newbieProtectTplt","round",e);if(t){switch(t.aiType){case 1:this.aiStrategy=AIStrategy.Radical;break;case 2:this.aiStrategy=AIStrategy.Calm;break;case 3:this.aiStrategy=AIStrategy.Conservatism}this.dangerDetectDistance=t.dangerDetectDistance,this.speed=t.speed}}},killPlayerLogic:function(e){if(e.murder===this&&(this.killCnt++,this.continueKillCnt++),e.victim===this)if(this.murder=e.murder,this.continueKillCnt=0,this.isAI){this.speedUpInterval&&(clearInterval(this.speedUpInterval),this.speedUpUI&&this.speedUpUI.destroy(),this.speedUpEffect&&this.speedUpEffect.destroy());var t=dataFunc.randomNum(3,this.reviveCd);setTimeout(function(){if(GameManager.gameState===GameState.Play&&this.isValid){var e=500;if(GameManager.SystemInfo&&GameManager.SystemInfo.benchmarkLevel){var t=dataFunc.queryOne("benchmarkLevel","benchmarkLevel",GameManager.SystemInfo.benchmarkLevel);t&&(e=t.maxFansLimit)}var a=FansManager.fans.length;Math.random()<this.reviveVipRate||a>e?this.reviveNormal():this.reviveVip()}}.bind(this),1e3*t)}else window.wx&&wx.aldSendEvent("\u73a9\u5bb6\u6b7b\u4ea1")},getFansAmount:function(){return this.fans.length},addFan:function(e){if(e||(e=FansManager.getFan()),e){e.node.parent=this.fansParent,e.node.color=this.characterColor,e.hostPlayer=this,this.fans.push(e),this.fans.length>this.maxFansCnt&&(this.maxFansCnt=this.fans.length),this.isRender||(e.node.active=!1),this.fansCntLb.string=this.fans.length,this.fansCntBg.width=128+30*(this.fans.length>100?2:this.fans.length>10?1:0);var t=this.fans.length/1e3;t>.2&&(t=.2),this.node.scale=.6+3*t;for(var a=this.playerLv,i=[].concat(dataFunc.getTableArr("level")),s=0;s<i.length&&this.fans.length>=i[s].fanCnt;s++)this.playerLv=i[s].level;this.playerLv>a&&(n.dispatchEvent("levelUp",this),this.fansCircleCheck.sizeUpdate(1.5),this.shadow&&this.shadow.sizeUpdate(),this.eatMaxCd-=.003),n.dispatchEvent("addFan",this)}},levelUp:function(){this.playerLv++},removeFan:function(e){this.eatNowTime=this.eatMaxCd;for(var t=0;t<this.fans.length;t++)if(this.fans[t]===e){this.fans.splice(t,1);break}if(this.fans.length<=0)this.node.active=!1,this.shadow&&(this.shadow.node.active=!1),this.nameNode&&(this.nameNode.active=!1),this.fansCntLb&&(this.fansCntLb.node.active=!1),this.fansCntBg&&(this.fansCntBg.active=!1);else{for(var a=this.playerLv,i=[].concat(dataFunc.getTableArr("level")),s=0;s<i.length&&this.fans.length>=i[s].fanCnt;s++)this.playerLv=i[s].level;this.playerLv<a&&(n.dispatchEvent("levelDown",this),this.fansCircleCheck.sizeUpdate(1.5),this.shadow.sizeUpdate(),this.eatMaxCd+=.003),this.fansCntLb.string=this.fans.length,this.fansCntBg.width=128+30*(this.fans.length>100?2:this.fans.length>10?1:0);var r=this.fans.length/1e3;r>.2&&(r=.2),this.node.scale=.6+3*r}},reviveNormal:function(){this.revive(1)},reviveVip:function(){this.revive(this.maxFansCnt+10)},reviveDouble:function(){this.revive(2*this.maxFansCnt)},revive:function(e){for(var t=0;t<e;t++){var a=FansManager.getFan();this.addFan(a,!0)}this.setFanPosImmediately(),this.node.active=!0,this.shadow&&(this.shadow.node.active=!0),this.nameNode&&(this.nameNode.active=!0),this.fansCntLb&&(this.fansCntLb.node.active=!0),this.fansCntBg&&(this.fansCntBg.active=!0),this.setInvincibility(!0),setTimeout(function(){this.setInvincibility(!1)}.bind(this),5e3)},setInvincibility:function(e){if(this&&this.node){this.invincibility=e;var t=dataFunc.getTableArr("level");if(t)for(var a=this.playerLv,i=0;i<t.length;i++)if(t[i].level===a||i===t.length-1){this.invincibilityTag.initWidth||(this.invincibilityTag.initWidth=this.invincibilityTag.width),this.invincibilityTag.initHeight||(this.invincibilityTag.initHeight=this.invincibilityTag.height),this.invincibilityTag.width=t[i].invincibilitySizeFactor*this.invincibilityTag.initWidth,this.invincibilityTag.height=t[i].invincibilitySizeFactor*this.invincibilityTag.initHeight;break}this.invincibilityTag.active=this.invincibility}},getInvincibility:function(){return this.invincibility},setFanPosImmediately:function(){for(var e=0,t=0;t<r.length;t++)for(var a=r[t],i=360/a,n=0;n<a;n++){var o=2*Math.PI/360*i*n,h=s[t]*Math.cos(o),c=s[t]*Math.sin(o),d=cc.v2(this.node.x+h,this.node.y+c);if(!(e<this.fans.length))return;this.fans[e].node.position=d,e++}},speedUp:function(e){if(this.speedUpInterval&&(clearInterval(this.speedUpInterval),this.speedUpUI&&this.speedUpUI.destroy(),this.speedUpEffect&&this.speedUpEffect.destroy()),this.speedUpUI=PlayerManager.addSpeedUpUI(this),this.speedUpEffect=PlayerManager.addSpeedEffect(this),e===o.speedType.gold){this.speed=o.speedGoldAddPra/100*this.initSpeed;var t=dataFunc.queryOne("growUpLevel","level",i.sprintLevel);t&&!this.isAI?this.speedUpNowTime=t.sprintTime:this.speedUpNowTime=o.speedGoldTime,this.speedUpUI.getChildByName("speeduping").getComponent(cc.Animation).play("goldSpeedUp").speed=3/this.speedUpNowTime}else this.speed=1.3*this.initSpeed,this.speedUpNowTime=this.speedUpMaxTime;this.speedUpInterval=setInterval(function(){this&&this.node&&this.isValid?this.speedUpNowTime<=0&&(this.speedUpUI.destroy(),this.speedUpEffect.destroy(),this.speed=this.initSpeed,clearInterval(this.speedUpInterval)):clearInterval(this.speedUpInterval)}.bind(this),1e3),this.propUseCnt++},reRenderFans:function(){for(var e=0;e<this.fans.length;e++)this.fans[e].node.active=!0},hideFans:function(){for(var e=0;e<this.fans.length;e++)this.fans[e].node.active=!1},update:function(e){if(GameManager.gameState===GameState.Play){if(this.isAI){var t=2080/PlayerManager.getWorldScale(),a=this.isRender,i=this.node.position.sub(PlayerManager.player.node.position).mag();this.isRender=i<t,a!==this.isRender&&(this.isRender?this.reRenderFans():this.hideFans()),this.updateBattleArray(),this.isRender||this.setFanPosImmediately(),this.AILogic(e)}else this.TrySpeedUpGuide(),this.updateBattleArray(),this.node.x<-.5*GameManager.BoundSize.x&&(this.node.x=-.5*GameManager.BoundSize.x),this.node.x>.5*GameManager.BoundSize.x&&(this.node.x=.5*GameManager.BoundSize.x),this.node.y<-.5*GameManager.BoundSize.y&&(this.node.y=-.5*GameManager.BoundSize.y),this.node.y>.5*GameManager.BoundSize.y&&(this.node.y=.5*GameManager.BoundSize.y);var n=this.node.x-this.lastPos.x,s=this.node.y-this.lastPos.y;this.lastPos=this.node.position,this.circleCheckerUpdate(n,s),this.directionUpdate(n,s),this.detectIfInObstacle(),this.playAnimation(e),this.eatNowTime-=e,this.speedUpNowTime-=e}},updateBattleArray:function(){var e=GameManager.Joystick._angle;if(this.lastAngle||(this.lastAngle=e),Math.abs(e-this.lastAngle)>90){this.lastAngle=e;for(var t=0;t<this.fans.length;t++)this.fans[t].resetRandomFactor()}for(var a=0,i=this.fans.length,n=0;n<r.length;n++)if((i-=r[n])<0){a=n;break}for(var o=2*Math.PI/360*e,h=Math.cos(o)*s[a],c=Math.sin(o)*s[a],d=0,l=0;l<r.length;l++)for(var p=r[l],g=360/p,m=0;m<p;m++){var y=2*Math.PI/360*g*m,u=s[l]*Math.cos(y),f=s[l]*Math.sin(y),v=cc.v2(this.node.x-h+u,this.node.y-c+f);if(!(d<this.fans.length))return;this.fans[d].setTargetPos(v),d++}},calcAngleDegrees:function(e,t){return 180*Math.atan2(t,e)/Math.PI},detectIfInObstacle:function(){var e=ObstaclesManager.detectIfInObstacle(this.node.position);if(e&&(this.node.position=e,this.isAI&&(this.targetFan&&(this.forbiddenFans.push(this.targetFan),this.targetFan=null),this.targetPlayer&&(this.forbiddenPlayers.push(this.targetPlayer),this.targetPlayer=null),this.dangerList&&this.dangerList.length>0)))for(var t=0;t<this.dangerList.length;t++){for(var a=!1,i=0;i<this.forbiddenDangers.length;i++)if(this.forbiddenDangers[i].player===this.dangerList[t].player){a=!0;break}a||this.forbiddenDangers.push(this.dangerList[t].player)}},circleCheckerUpdate:function(e,t){this.angle=Math.atan2(t,e)*(180/Math.PI);var a=this.fansCircleCheck.node.parent.rotation,i=180-this.angle,n=i-a;n>180?this.fansCircleCheck.node.parent.rotation+=360:n<-180&&(this.fansCircleCheck.node.parent.rotation-=360),this.fansCircleCheck.node.parent.rotation=cc.misc.lerp(this.fansCircleCheck.node.parent.rotation,i,.09)},directionUpdate:function(e,t){var a=""+(t<-5?1:0)+(t>5?1:0)+(e>5?1:0)+(e<-5?1:0);this.direction=parseInt(a,2)},AILogic:function(e){this.dangerList=this.getDanger(),this.gestureState();var t=0;if(this.dangerList.length>0){if(1===this.dangerList.length){var a=this.node.position.sub(this.dangerList[0].player.node.position);if(this.dangerList[0].player===PlayerManager.player){t=this.calcAngleDegrees(a.x,a.y)%360;var i=GameManager.Joystick._angle%360;if(Math.abs(i-t)>60){var n=this.getTargetFan();if(n){var s=n.node.position.sub(this.node.position);t=this.calcAngleDegrees(s.x,s.y)}}}else t=this.calcAngleDegrees(a.x,a.y)}else{var r=this.node.position.sub(this.dangerList[0].player.node.position),o=this.node.position.sub(this.dangerList[1].player.node.position);t=(this.calcAngleDegrees(r.x,r.y)+this.calcAngleDegrees(o.x,o.y))/2}this.AITrySpeedUp()}else if(this.targetPlayer=this.getTargetPlayer(),this.targetPlayer){var h=this.targetPlayer.node.position.sub(this.node.position);t=this.calcAngleDegrees(h.x,h.y),this.AITrySpeedUp()}else{var c=this.getTargetFan();if(c){var d=c.node.position.sub(this.node.position);t=this.calcAngleDegrees(d.x,d.y)}}var l=cc.v2(Math.cos(t*(Math.PI/180))*this.speed,Math.sin(t*(Math.PI/180))*this.speed);this.node.x+=l.x*e,this.node.y+=l.y*e,this.node.x<-.5*GameManager.BoundSize.x&&(this.node.x=-.5*GameManager.BoundSize.x),this.node.x>.5*GameManager.BoundSize.x&&(this.node.x=.5*GameManager.BoundSize.x),this.node.y<-.5*GameManager.BoundSize.y&&(this.node.y=-.5*GameManager.BoundSize.y),this.node.y>.5*GameManager.BoundSize.y&&(this.node.y=.5*GameManager.BoundSize.y),this.curForbiddenTime||(this.curForbiddenTime=0),this.curForbiddenTime+=e,this.curForbiddenTime>this.clearForbiddenCd&&(this.curForbiddenTime=e,this.forbiddenFans=[],this.forbiddenPlayers=[]),this.curClearDangersTime||(this.curClearDangersTime=0),this.curClearDangersTime+=e,this.curClearDangersTime>this.clearDangersCd&&(this.curClearDangersTime=e,this.forbiddenDangers=[])},TrySpeedUpGuide:function(){if(!this.isAI&&!(this.speedUpNowTime>0||h.getConfigData("speedUpGuide")))for(var e=0;PlayerManager.players&&e<PlayerManager.players.length;e++){var t=PlayerManager.players[e];if(t!==this&&t.node.active){if(this.forbiddenDangers.indexOf(t)>0)continue;if(this.node.position.sub(t.node.position).mag()<cc.Canvas.instance.node.width){n.dispatchEvent("speedUpGuide",this);break}}}},AITrySpeedUp:function(){this.propUseCnt>=this.propUseTotalCnt||(GameManager.fadeTime<this.propUseTimeDelay||this.speedUpNowTime<0&&(Math.random()>this.propUseRate?this.speedUpNowTime=this.propFailCd:this.speedUp(o.speedType.gold)))},getDanger:function(){for(var e=[],t=0;PlayerManager.players&&t<PlayerManager.players.length;t++){var a=PlayerManager.players[t];if(a!==this&&a.node.active){if(this.forbiddenDangers.indexOf(a)>0)continue;var i=this.node.position.sub(a.node.position).mag();i<this.dangerDetectDistance&&a.getFansAmount()>this.getFansAmount()&&e.push({distance:i,player:a})}}return e.sort(function(e,t){return e.distance-t.distance}),e},gestureState:function(){if(this.isAI){for(var e=!1,t=0;t<PlayerManager.players.length;t++){var a=PlayerManager.players[t];if(a!==this&&a.node.active){if(this.forbiddenDangers.indexOf(a)>0||a.isAI)continue;this.node.position.sub(a.node.position).mag()<1e3&&(this.setTime&&(this.setTime=null),n.dispatchEvent("showGestures",!0),e=!0)}}e||(this.setTime=setTimeout(function(){n.dispatchEvent("showGestures",!1)},1e3))}},getTargetPlayer:function(){if(this.aiStrategy){for(var e=null,t=0;PlayerManager.players&&t<PlayerManager.players.length;t++){var a=PlayerManager.players[t];if(a!==this&&a.node.active&&!a.getInvincibility()){if(this.forbiddenPlayers.indexOf(a)>=0)continue;if(this.getFansAmount()-a.getFansAmount()>=this.aiStrategy.fansDelta)if(e){var i=this.node.position.sub(e.node.position).mag(),n=this.node.position.sub(a.node.position).mag();e=n<this.aiStrategy.detectionRange&&i<this.aiStrategy.detectionRange?null:i<n?e:a}else{this.node.position.sub(a.node.position).mag()<this.aiStrategy.detectionRange&&(e=a)}}}return e===PlayerManager.player&&PlayerManager.player.characterLv<6&&GameManager.protectTime>0&&(e=null),e}},getTargetFan:function(){if(this.targetFan&&!this.targetFan.hostPlayer)return this.targetFan;this.targetFan=null;for(var e=Number.MAX_VALUE,t=0;t<FansManager.fans.length;t++){var a=FansManager.fans[t];if(!(this.forbiddenFans.indexOf(a)>=0)&&!a.hostPlayer){var i=!1;this.lvInfo&&(i=Math.random()>this.lvInfo.errorRate);var n=a.node.position.sub(this.node.position).mag();if(n<e&&(e=n,this.targetFan=a,i&&e<2e3))break}}return this.targetFan},playAnimation:function(e){if(this.anim&&(this.curAnimFrame?this.curAnimFrame+=e:this.curAnimFrame=e,!(this.curAnimFrame<this.deltaAnimFrame))){switch(this.curAnimFrame=0,this.direction){case Direction.Right:this.anim=this.Right,this.bodySprite.node.scaleX=-1;break;case Direction.Left:this.anim=this.Left,this.bodySprite.node.scaleX=1;break;case Direction.Down:this.anim=this.Down,this.bodySprite.node.scaleX=1;break;case Direction.Up:this.anim=this.Up,this.bodySprite.node.scaleX=1;break;case Direction.RightDown:this.anim=this.RightDown,this.bodySprite.node.scaleX=-1;break;case Direction.RightUp:this.anim=this.RightUp,this.bodySprite.node.scaleX=-1;break;case Direction.LeftDown:this.anim=this.LeftDown,this.bodySprite.node.scaleX=1;break;case Direction.LeftUp:this.anim=this.LeftUp,this.bodySprite.node.scaleX=1}this.anim.spriteFrameIndex||(this.anim.spriteFrameIndex=0),this.anim.spriteFrameIndex++,this.anim.spriteFrameIndex>=this.anim.length&&(this.anim.spriteFrameIndex=0),this.bodySprite.spriteFrame=this.anim[this.anim.spriteFrameIndex]}},onDestroy:function(){n.off("killPlayerLogic",this.killPlayerLogic.bind(this))}}),cc._RF.pop()},{}],ShadowManager:[function(e,t,a){"use strict";cc._RF.push(t,"b8030cdGlxIKK9f9lb/H5VY","ShadowManager"),cc.Class({extends:cc.Component,properties:{shadowPrefab:cc.Prefab,shadowParent:cc.Node},onLoad:function(){window.ShadowManager=this},addShadow:function(e){var t=cc.instantiate(this.shadowPrefab);t.parent=this.shadowParent;var a=t.getComponent("Shadow");return a.setHost(e),a}}),cc._RF.pop()},{}],Shadow:[function(e,t,a){"use strict";cc._RF.push(t,"4e524sRHDNJl7R6wIo03PPV","Shadow"),cc.Class({extends:cc.Component,setHost:function(e){this.host=e;var t=this.host.getComponent("Player");t?this.bodySpritNode=t.bodySprite.node:(t=this.host.getComponent("fan"),this.bodySpritNode=t?t.bodySprite.node:this.host),this.sizeUpdate()},sizeUpdate:function(){this.node.scale=this.host.scale,this.node.width=this.bodySpritNode.width+10},lateUpdate:function(){if(this.host&&this.host.active){var e=this.host.scaleY*this.bodySpritNode.height*.5,t=this.host.convertToWorldSpaceAR(cc.v2(0,0)),a=this.node.parent.convertToNodeSpaceAR(t);this.node.x=a.x,this.node.y=a.y-e,this.node.opacity=this.host.opacity}else this.node.opacity=0}}),cc._RF.pop()},{}],UIGamePanel:[function(e,t,a){"use strict";cc._RF.push(t,"5cc93xxTodL94Sgd2YI0g5h","UIGamePanel");var i=kf.require("basic.clientEvent"),n=kf.require("shared.constants"),s=kf.require("logic.platform"),r=kf.require("logic.user"),o=kf.require("basic.configuration"),h=0,c=1,d=2;cc.Class({extends:cc.Component,properties:{killTipUI:cc.Node,countDownLb:cc.Label,timeOverPrefab:cc.Prefab,deadPanelPrefab:cc.Prefab,killCntLb:cc.Label,propBtn:cc.Node,speedBtn:cc.Node,propSp:cc.Sprite,speedUpSf:cc.SpriteFrame,levelUpAnimation:cc.Animation,leftTimeTip:cc.Node,leftTimeTipLb:cc.Label,readyGo:cc.Node,guideUI:cc.Node,readyEnd:cc.Node,readyEndLb:cc.Label,daojvPrompt:cc.Node,freePrompt:cc.Node,gestures:cc.Node,screenShootAnim:cc.Animation,victoryAnim:cc.Animation,otherBtn1:cc.Node,image1:cc.Node,nameLb1:cc.Label,speedUpGuide1:cc.Node,speedUpGuide2:cc.Node,recorderBtn:cc.Node},onLoad:function(){this.readyGo.active=!0,this.isKillPlayerTipPlaying=!1,this.leftTimeTip.active=!1,this.propAnim=this.propBtn.getComponent(cc.Animation),this.propAnim.on("finished",this.propAnimFinish.bind(this)),this.speedAnim=this.speedBtn.getComponent(cc.Animation),this.speedAnim.on("finished",this.goldSpeedAnimFinish.bind(this)),this.killTipUIAnim=this.killTipUI.getComponent(cc.Animation),this.guideLogic(),GameManager.gameState=GameState.Pause,setTimeout(function(){GameManager.gameState=GameState.Play,GameManager.touchStart&&this.guideClose()}.bind(this),4e3),r.todayFirstLogin?(this.daojvPrompt.active=!1,this.freePrompt.active=!0,this.gestures.active=!0):(this.daojvPrompt.active=!0,this.freePrompt.active=!1,this.gestures.active=!1),setTimeout(function(){var e=3;r.setAudio("countDown");var t=setInterval(function(){0!==--e?r.setAudio("countDown"):(r.setAudio("go"),clearInterval(t))},1e3)},500),this.randomIndex=dataFunc.randomNum(0,r.otherGameData.length-1),this.showMoreMaxCd=3,this.showMoreCurCd=0,this.otherBtn1.on("click",function(){r.setAudio("btnClick"),window.wx&&(wx.aldSendEvent("\u5356\u91cf-\u6e38\u620f\u754c\u9762-\u8f6e\u64ad"),wx.aldSendEvent("\u5356\u91cf-"+r.otherGameData[this.randomIndex].name)),this.navigateToMiniProgram(this.randomIndex),console.log("open game:"+r.otherGameData[this.randomIndex].name),this.showMoreOtherGame()}.bind(this)),r.underReview&&(this.otherBtn1.active=!1),window.tt?(this.otherBtn1.active=!1,this.recorderBtn.active=!0):this.recorderBtn.active=!1,this.killTipQueue=[],i.on("_touchStartEvent",this._touchStartEvent.bind(this)),i.on("speedUpGuide",this.speedUpGuide.bind(this))},speedUpGuide:function(){this.speedUpGuide1.active=!0,this.speedUpGuide2.active=!0},navigateToMiniProgram:function(e){window.wx&&(this.gameId=r.otherGameData[e].id,console.log("#######"+this.gameId),wx.navigateToMiniProgram({appId:r.otherGameData[e].appid,path:r.otherGameData[e].path,success:function(e){r.reportChannelData(this.gameId)}.bind(this)}))},update:function(e){if(this.showMoreCurCd-=e,this.showMoreCurCd<0&&this.showMoreOtherGame(),!this.isKillPlayerTipPlaying&&this.killTipQueue.length>0){var t=this.killTipQueue.shift();this.killPlayerTip(t)}},showMoreOtherGame:function(){this.showMoreCurCd=this.showMoreMaxCd,this.randomIndex+=1,this.randomIndex>=r.otherGameData.length&&(this.randomIndex=0),this.showOtherGameBtn(this.image1,this.nameLb1,this.randomIndex)},showOtherGameBtn:function(e,t,a){var i=r.otherGameData[a];if(1===i.logo_status)r.headImage(i.logo,e);else for(var n=0;n<GameManager.appIcons.length;n++)if(GameManager.appIcons[n].name===i.client_logo){e.getComponent(cc.Sprite).spriteFrame=GameManager.appIcons[n];break}t.string=i.name},propAnimFinish:function(){this.isValid&&"propCd"===this.propAnim.currentClip.name&&this.propAnim.play("propAnim")},goldSpeedAnimFinish:function(){this.isValid&&"goldPropCd"===this.speedAnim.currentClip.name&&this.speedAnim.play("speedBtnAnim")},_touchStartEvent:function(){this.guideClose()},guideLogic:function(){this.speedUpGuide1.active=!1,this.speedUpGuide2.active=!1,this.guideUI.active=!1;var e=o.getConfigData("roundCnt");if(e){var t=parseInt(e);this.guideUI.active=t<2,t++,o.setConfigData("roundCnt",t+"")}else this.guideUI.active=!0,o.setConfigData("roundCnt","1")},start:function(){switch(window.wx&&wx.aldSendEvent("\u6e38\u620f\u754c\u9762"),this.propType=dataFunc.randomNum(d,d),this.propType){case h:this.propSp.spriteFrame=this.magnetSf;break;case c:this.propSp.spriteFrame=this.doubleFanSf;break;case d:this.propSp.spriteFrame=this.speedUpSf}GameManager.protectTime=30,GameManager.fadeTime=0,this.totalTime=GameManager.totalTime,this.setLeftTime(),this.killCnt=0,this.killCntLb.string=this.killCnt,this.killTipUI.opacity=0,this.cdId=setInterval(function(){if(this.isValid&&GameManager.gameState===GameState.Play){if(this.totalTime-=1,GameManager.fadeTime++,GameManager.protectTime--,this.setLeftTime(),this.totalTime<=5&&(this.readyEnd.active=!0,0===this.totalTime?this.readyEndLb.string="\u6ca1\u65f6\u95f4\u4e86":this.readyEndLb.string=this.totalTime,r.setAudio("countDown")),this.totalTime<=0)return this.timeOver(),void clearInterval(this.cdId);60===this.totalTime&&PlayerManager.changeAllAIStrategy(),60!==this.totalTime&&30!==this.totalTime&&10!==this.totalTime||(this.leftTimeTipLb.string=this.totalTime,this.leftTimeTip.active=!0,setTimeout(function(){this&&this.leftTimeTip&&(this.leftTimeTip.active=!1)}.bind(this),2e3))}}.bind(this),1e3),this.propBtn.on("click",this.prop.bind(this)),this.speedBtn.on("click",this.speed.bind(this)),i.on("killPlayerUI",this.killPlayerUI.bind(this)),i.on("levelUp",this.levelUp.bind(this)),i.on("showGestures",this.showGestures.bind(this)),r.recording=!1,this.recorderBtn.getChildByName("Label").getComponent(cc.Label).string="\u5f00\u59cb\u5f55\u5c4f",this.recorderBtn.on("click",function(){r.recording?(this.recorderBtn.getChildByName("Label").getComponent(cc.Label).string="\u5f00\u59cb\u5f55\u5c4f",r.recording=!1,s.getGameRecorder(!1)):(this.recorderBtn.getChildByName("Label").getComponent(cc.Label).string="\u7ed3\u675f\u5f55\u5c4f",r.recording=!0,s.getGameRecorder(!0))}.bind(this))},showGestures:function(e){this.propAnim.getAnimationState("propCd").isPlaying?this.gestures.active=!1:this.gestures.active=e},guideClose:function(){this&&this.guideUI&&GameManager.gameState===GameState.Play&&(this.guideUI.active=!1)},levelUp:function(e){this.isValid&&e===PlayerManager.player&&this.levelUpAnimation.play()},prop:function(){var e=this;if(GameManager.gameState===GameState.Play&&!(this.propAnim.getAnimationState("propCd").isPlaying||PlayerManager.player.speedUpNowTime>0)){window.tt||(GameManager.gameState=GameState.Pause),PlayerManager.player.setInvincibility(!0);var t=this;if(window.wx&&wx.aldSendEvent("Y\u52a0\u901f\u6309\u94ae"),this.propType===d&&r.todayFirstLogin)return r.todayFirstLogin=!1,this.daojvPrompt.active=!0,this.freePrompt.active=!1,this.gestures.active=!1,PlayerManager.speedUp(),this.propAnim.play("propCd"),setTimeout(function(){PlayerManager&&PlayerManager.player&&PlayerManager.player.setInvincibility(!1)},2e3),void(GameManager.gameState=GameState.Play);if(window.wx)s.shareAppMessage({title:"\u5f3a\u529b\u9053\u5177"},function(){if(e.isValid){switch(e.propType){case h:PlayerManager.magnet();break;case c:PlayerManager.doubleFan();break;case d:PlayerManager.speedUp()}t.propAnim.play("propCd"),setTimeout(function(){PlayerManager&&PlayerManager.player&&PlayerManager.player.setInvincibility(!1)},2e3),GameManager.gameState=GameState.Play}},function(){var e="\u53d1\u9001\u7ed9\u5176\u4ed6\u597d\u53cb\u8bd5\u8bd5";window.tt&&(e="\u5206\u4eab\u5931\u8d25"),wx.showToast({title:e,icon:"none",duration:1500}),setTimeout(function(){PlayerManager&&PlayerManager.player&&PlayerManager.player.setInvincibility(!1)},2e3),GameManager.gameState=GameState.Play},n.shareId.powerfulProp);else{switch(this.propType){case h:PlayerManager.magnet();break;case c:PlayerManager.doubleFan();break;case d:PlayerManager.speedUp()}t.propAnim.play("propCd"),setTimeout(function(){PlayerManager&&PlayerManager.player&&PlayerManager.player.setInvincibility(!1)},2e3),GameManager.gameState=GameState.Play}}},speed:function(){var e=this;GameManager.gameState===GameState.Play&&(this.speedAnim.getAnimationState("goldPropCd").isPlaying||PlayerManager.player.speedUpNowTime>0||(window.wx&&0==this.speedUpGuide2.active?(wx.aldSendEvent("Y\u51b2\u523a\u6309\u94ae"),s.shareAppMessage({title:"\u51b2\u523a"},function(){this.isValid&&(PlayerManager.speedUp(n.speedType.gold),this.speedAnim.play("goldPropCd"),++PlayerManager.player.goldSpeedNum>=r.sprintCount&&!r.infiniteSprint&&(this.speedBtn.active=!1))}.bind(this),function(){e.isValid&&wx.showToast({title:"\u5956\u52b1\u83b7\u53d6\u5931\u8d25",icon:"none",duration:1500})},n.shareId.speed)):(PlayerManager.speedUp(n.speedType.gold),this.speedAnim.play("goldPropCd"),++PlayerManager.player.goldSpeedNum>=r.sprintCount&&!r.infiniteSprint&&(this.speedBtn.active=!1)),o.setConfigData("speedUpGuide","1"),this.speedUpGuide1.active=!1,this.speedUpGuide2.active=!1))},setLeftTime:function(){var e=this.totalTime<0?0:this.totalTime,t=Math.floor(e/60),a=e%60;this.countDownLb.string=t>0?a<10?t+"/0"+a:t+"/"+a:a<10?"0/0"+a:"0/"+a},timeOver:function(){this.node&&(this.deadPanel&&this.deadPanel.destroy(),GameManager.saveScore(),GameManager.gameState=GameState.TimeOver,setTimeout(function(){if(this.isValid){switch(this.readyEnd.active=!1,PlayerManager.players.indexOf(PlayerManager.player)){case 0:this.victoryAnim.play(),window.wx&&wx.aldSendEvent("\u73a9\u5bb6\u5403\u9e21"),GameManager.AILevelUp();break;case 1:case 2:case 3:case 4:break;case 5:case 6:case 7:GameManager.AILevelDown()}setTimeout(function(){r.setAudio("screenShoot");var e=(cc.Canvas.instance.node.height-576)/2,t=null;if(window.wx)try{canvas.toTempFilePath({x:0,y:e,width:720,height:576,destWidth:720,destHeight:576,success:function(e){t=e.tempFilePath}})}catch(e){}this.screenShootAnim.play(),setTimeout(function(){if(this.isValid){var e=cc.instantiate(this.timeOverPrefab);e.parent=this.node;var a=e.getComponent("uiTimeOver");a&&a.setData(t)}}.bind(this),400)}.bind(this),500)}}.bind(this),800))},killPlayerUI:function(e){this.killCntLb&&(e.victim===PlayerManager.player&&(GameManager.saveScore(),setTimeout(function(){this.isValid&&(this.deadPanel=cc.instantiate(this.deadPanelPrefab),this.deadPanel.parent=this.node,this.deadPanel.position=cc.v2(0,0))}.bind(this),1e3)),PlayerManager.player&&(this.killCntLb.string=PlayerManager.player.killCnt),this.killTipQueue.push(e))},killPlayerTip:function(e){this.isKillPlayerTipPlaying=!0,this.killTipUI.getComponent("killTip").setName(e),this.killTipUIAnim.play(),r.setAudio("kill"),window.wx&&r.vibrateOn&&wx.vibrateLong(),setTimeout(function(){this.isKillPlayerTipPlaying=!1}.bind(this),1e3)},onDestroy:function(){clearInterval(this.cdId),i.off("_touchStartEvent",this._touchStartEvent.bind(this)),i.off("killPlayerUI",this.killPlayerUI.bind(this)),i.off("levelUp",this.levelUp.bind(this)),i.off("showGestures",this.showGestures.bind(this)),i.off("speedUpGuide",this.speedUpGuide.bind(this))}}),cc._RF.pop()},{}],enemyPosArrow:[function(e,t,a){"use strict";cc._RF.push(t,"2fd54Xpd2BPoo8CrLvrUhvI","enemyPosArrow"),cc.Class({extends:cc.Component,setHostPlayer:function(e){this.hostPlayer=e,this.node.color=this.hostPlayer.uiColor,this.playerCamera=cc.Camera.findCamera(this.hostPlayer.node)},calcAngleDegrees:function(e,t){return 180*Math.atan2(t,e)/Math.PI},update:function(e){if(this.hostPlayer&&this.hostPlayer.node.active){var t=this.hostPlayer.node.convertToWorldSpaceAR(cc.v2(0,0)),a=this.node.parent.convertToNodeSpaceAR(t),i=.5*cc.Canvas.instance.node.width,n=.5*cc.Canvas.instance.node.height,s=cc.v2(-i,-n),r=cc.v2(-i,n),o=cc.v2(i,-n),h=cc.v2(i,n),c=this.segmentsIntr(s,r,cc.v2(0,0),a);if(c||(c=this.segmentsIntr(o,h,cc.v2(0,0),a)),c||(c=this.segmentsIntr(r,h,cc.v2(0,0),a)),c||(c=this.segmentsIntr(s,o,cc.v2(0,0),a)),c){this.node.position=c;var d=this.calcAngleDegrees(a.x,a.y);this.node.rotation=-d,this.node.opacity=255}else{var l=this.hostPlayer.node.convertToWorldSpaceAR(cc.v2(0,0)),p=cc.v2(0,0);this.playerCamera.getWorldToCameraPoint(l,p),p.x>0&&p.x<cc.Canvas.instance.node.width&&p.y>0&&p.y<cc.Canvas.instance.node.height&&(this.node.opacity=0)}}else this.node.opacity=0},segmentsIntr:function(e,t,a,i){var n=(t.y-e.y)*(i.x-a.x)-(e.x-t.x)*(a.y-i.y);if(0==n)return!1;var s=((t.x-e.x)*(i.x-a.x)*(a.y-e.y)+(t.y-e.y)*(i.x-a.x)*e.x-(i.y-a.y)*(t.x-e.x)*a.x)/n,r=-((t.y-e.y)*(i.y-a.y)*(a.x-e.x)+(t.x-e.x)*(i.y-a.y)*e.y-(i.x-a.x)*(t.y-e.y)*a.y)/n;return(s-e.x)*(s-t.x)<=0&&(r-e.y)*(r-t.y)<=0&&(s-a.x)*(s-i.x)<=0&&(r-a.y)*(r-i.y)<=0&&{x:s,y:r}}}),cc._RF.pop()},{}],enemyPosName:[function(e,t,a){"use strict";cc._RF.push(t,"63177du7wNMJ7ZmBNr0WI3X","enemyPosName"),cc.Class({extends:cc.Component,properties:{nickNameLb:cc.Label,bgNode:cc.Node},setHostPlayer:function(e){this.hostPlayer=e,this.bgNode.color=this.hostPlayer.uiColor,this.playerCamera=cc.Camera.findCamera(this.hostPlayer.node)},calcAngleDegrees:function(e,t){return 180*Math.atan2(t,e)/Math.PI},update:function(e){if(this.hostPlayer&&this.hostPlayer.node.active){var t=this.hostPlayer.getFansAmount();this.nickNameLb.string=t,this.bgNode.width=128+30*(t>100?2:t>10?1:0);var a=this.hostPlayer.node.convertToWorldSpaceAR(cc.v2(0,0)),i=this.node.parent.convertToNodeSpaceAR(a),n=.5*cc.Canvas.instance.node.width,s=.5*cc.Canvas.instance.node.height,r=cc.v2(-n,-s),o=cc.v2(-n,s),h=cc.v2(n,-s),c=cc.v2(n,s),d=this.segmentsIntr(r,o,cc.v2(0,0),i);if(d||(d=this.segmentsIntr(h,c,cc.v2(0,0),i)),d||(d=this.segmentsIntr(o,c,cc.v2(0,0),i)),d||(d=this.segmentsIntr(r,h,cc.v2(0,0),i)),d){this.node.position=d;var l=this.calcAngleDegrees(i.x,i.y);this.node.rotation=-l,this.node.opacity=255}else{var p=this.hostPlayer.node.convertToWorldSpaceAR(cc.v2(0,0)),g=cc.v2(0,0);this.playerCamera.getWorldToCameraPoint(p,g),g.x>0&&g.x<cc.Canvas.instance.node.width&&g.y>0&&g.y<cc.Canvas.instance.node.height&&(this.node.opacity=0)}}else this.node.opacity=0},segmentsIntr:function(e,t,a,i){var n=(t.y-e.y)*(i.x-a.x)-(e.x-t.x)*(a.y-i.y);if(0==n)return!1;var s=((t.x-e.x)*(i.x-a.x)*(a.y-e.y)+(t.y-e.y)*(i.x-a.x)*e.x-(i.y-a.y)*(t.x-e.x)*a.x)/n,r=-((t.y-e.y)*(i.y-a.y)*(a.x-e.x)+(t.x-e.x)*(i.y-a.y)*e.y-(i.x-a.x)*(t.y-e.y)*a.y)/n;return(s-e.x)*(s-t.x)<=0&&(r-e.y)*(r-t.y)<=0&&(s-a.x)*(s-i.x)<=0&&(r-a.y)*(r-i.y)<=0&&{x:s,y:r}}}),cc._RF.pop()},{}],fan:[function(e,t,a){"use strict";cc._RF.push(t,"3152bceyCFOj4kdXEVnRHJe","fan");Math.PI;cc.Class({extends:cc.Component,properties:{bodySprite:cc.Sprite,verifySF:cc.SpriteFrame,Left:[cc.SpriteFrame],Right:[cc.SpriteFrame],Up:[cc.SpriteFrame],Down:[cc.SpriteFrame],Left2:[cc.SpriteFrame],Right2:[cc.SpriteFrame],Up2:[cc.SpriteFrame],Down2:[cc.SpriteFrame]},onLoad:function(){var e=kf.require("logic.user");switch(e.underReview?(this.bodySprite.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.bodySprite.spriteFrame=this.verifySF):this.bodySprite.spriteFrame=null,this.direction=Math.pow(2,dataFunc.randomNum(0,3)),e.underReview&&(this.Left=this.Left2,this.Right=this.Right2,this.Up=this.Up2,this.Down=this.Down2),this.direction){case Direction.Left:this.anim=this.Left;break;case Direction.Right:this.anim=this.Right;break;case Direction.Up:this.anim=this.Up;break;case Direction.Down:this.anim=this.Down}this.curChangeDirTime=0,this.changeDirMinCd=3,this.changeDirMaxCd=15,this.deltaAnimFrame=.1,this.Left.spriteFrameIndex=0,this.Right.spriteFrameIndex=0,this.Up.spriteFrameIndex=0,this.Down.spriteFrameIndex=0},start:function(){this.fanAnimation=this.node.getComponent(cc.Animation),this.offsetX=100*(Math.random()-.5),this.offsetY=200*(Math.random()-.5),this.resetRandomFactor(!0)},setTargetPos:function(e){this.targetPos=e},resetRandomFactor:function(e){this.randomFactor=4.5+.5*Math.random();var t=1;this.hostPlayer&&(t=this.hostPlayer.playerLv),e?(this.offsetX=100*(Math.random()-.5)*t,this.offsetY=100*(Math.random()-.5)*t):(this.offsetX+=10*(Math.random()-.5)*t,this.offsetY+=10*(Math.random()-.5)*t),this.offsetX>50*t?this.offsetX=50*t:this.offsetX<-50*t&&(this.offsetX=-50*t),this.offsetY>50*t?this.offsetY=50*t:this.offsetY<-50*t&&(this.offsetY=-50*t)},update:function(e){if(this.playAnimation(e),GameManager.gameState===GameState.Play)if(this.hostPlayer){if(this.targetPos){var t=!1,a=Math.atan2(this.node.y-this.hostPlayer.node.y,this.node.x-this.hostPlayer.node.x)*dataFunc.get1Rad();if(Math.abs(this.hostPlayer.angle-a)<90&&(t=!0),t)this.randomFactor=3;else{this.randomFactor<=3&&this.resetRandomFactor();var i=this.node.position.sub(this.hostPlayer.node.position).mag();i>300?this.randomFactor+=.003:i>200?this.randomFactor+=.002:i>100?this.randomFactor+=.001:i<0&&(this.randomFactor-=.001)}var n=.2*this.hostPlayer.speed,s=ObstaclesManager.detectIfInObstacle(this.targetPos);s&&(this.targetPos=s);var r=this.targetPos.x+this.offsetX-this.node.x;r>n&&(r=n),r<-n&&(r=-n);var o=this.targetPos.y+this.offsetY-this.node.y;o>n&&(o=n),o<-n&&(o=-n),this.node.x+=r*this.randomFactor*e,this.node.y+=o*this.randomFactor*e,s=ObstaclesManager.detectIfInObstacle(this.node.position),this.node.opacity=s?0:255,this.checkOutBound(0)}}else{switch(this.direction){case Direction.Left:this.node.x-=50*e;break;case Direction.Right:this.node.x+=50*e;break;case Direction.Up:this.node.y+=50*e;break;case Direction.Down:this.node.y-=50*e}if(this.curChangeDirTime-=e,this.curChangeDirTime<0)this.curChangeDirTime=dataFunc.randomNum(this.changeDirMinCd,this.changeDirMaxCd),this.direction=Math.pow(2,dataFunc.randomNum(0,3));else{var h=this.checkOutBound(0),c=ObstaclesManager.detectIfInObstacle(this.node.position);(c||h)&&(c&&(this.node.position=c),this.direction=Math.pow(2,dataFunc.randomNum(0,3)))}}},checkOutBound:function(e){var t=!1;return this.node.x<-.5*GameManager.BoundSize.x+e&&(this.node.x=-.5*GameManager.BoundSize.x+e,t=!0),this.node.x>.5*GameManager.BoundSize.x-e&&(this.node.x=.5*GameManager.BoundSize.x-e,t=!0),this.node.y<-.5*GameManager.BoundSize.y+e&&(this.node.y=-.5*GameManager.BoundSize.y+e,t=!0),this.node.y>.5*GameManager.BoundSize.y-e&&(this.node.y=.5*GameManager.BoundSize.y-e,t=!0),t},playAnimation:function(e){if(this.hostPlayer)this.bodySprite.spriteFrame!==this.hostPlayer.bodySprite.spriteFrame&&(this.bodySprite.spriteFrame=this.hostPlayer.bodySprite.spriteFrame,this.bodySprite.node.scaleX=Math.sign(this.hostPlayer.bodySprite.node.scaleX)*Math.abs(this.bodySprite.node.scaleX));else{if(this.curAnimFrame?this.curAnimFrame+=e:this.curAnimFrame=e,this.curAnimFrame<this.deltaAnimFrame)return;switch(this.curAnimFrame=0,this.direction){case Direction.Right:this.anim=this.Right,this.bodySprite.node.scaleX=-.5;break;case Direction.Left:this.anim=this.Left,this.bodySprite.node.scaleX=.5;break;case Direction.Down:this.anim=this.Down,this.bodySprite.node.scaleX=.5;break;case Direction.Up:this.anim=this.Up,this.bodySprite.node.scaleX=.5}this.anim.spriteFrameIndex++,this.anim.spriteFrameIndex>=this.anim.length&&(this.anim.spriteFrameIndex=0),this.bodySprite.spriteFrame=this.anim[this.anim.spriteFrameIndex]}}}),cc._RF.pop()},{}],killTip:[function(e,t,a){"use strict";cc._RF.push(t,"e95e5Kx6+9GOrTq3vFBL5Ph","killTip");var i=["\u51fb\u6740","\u53cc\u6740","\u4e09\u6740","\u65e0\u4eba\u80fd\u6321","\u5927\u6740\u7279\u6740","\u8d85\u795e"];cc.Class({extends:cc.Component,properties:{murder:cc.Label,victim:cc.Label,tipWordLb:cc.Label},setName:function(e){this.murder.string=e.murder.playerName,this.murder.node.color=e.murder.uiColor,this.victim.string=e.victim.playerName,this.victim.node.color=e.victim.uiColor;var t=e.murder.continueKillCnt>=i.length?i.length-1:e.murder.continueKillCnt-1;this.tipWordLb.string=i[t]}}),cc._RF.pop()},{}],rankDetail:[function(e,t,a){"use strict";cc._RF.push(t,"706278Ng9pFhJJ6XX1XpPnO","rankDetail"),cc.Class({extends:cc.Component,properties:{rankIndex:cc.Label,fansCntLb:cc.Label,playerNameLb:cc.Label},setData:function(e){this.rankIndex.string="."+e.rank,this.fansCntLb.string="-"+e.fansCnt,this.playerNameLb.string=e.playerName,e.isMainPlayer||(this.rankIndex.node.color=e.color,this.fansCntLb.node.color=e.color,this.playerNameLb.node.color=e.color)}}),cc._RF.pop()},{}],timeOverRankDetail:[function(e,t,a){"use strict";cc._RF.push(t,"5cb159GgT5L9ooPqLVoGpZB","timeOverRankDetail"),cc.Class({extends:cc.Component,properties:{rankIndexLb:cc.Label,ranIndexSp:cc.Sprite,ranIndexSF:[cc.SpriteFrame],fansCntLb:cc.Label,playerNameLb:cc.Label,coinLb:cc.Label,bg:cc.Node,fanTag:cc.Node,deadTag:cc.Node},setData:function(e){e.rank<4?(this.rankIndexLb.node.active=!1,this.ranIndexSp.node.active=!0,e.rank<=this.ranIndexSF.length&&(this.ranIndexSp.spriteFrame=this.ranIndexSF[e.rank-1])):(this.rankIndexLb.node.active=!0,this.ranIndexSp.node.active=!1,this.rankIndexLb.string=e.rank+"th"),e.fansCnt<=0?(this.deadTag.active=!0,this.fanTag.active=!1,this.deadTag.color=e.color):(this.deadTag.active=!1,this.fanTag.active=!0,this.fansCntLb.string="x"+e.fansCnt,this.fansCntLb.node.color=e.color,this.fanTag.color=e.color),this.playerNameLb.string=e.playerName,this.playerNameLb.node.color=e.color,e.isSelf?this.bg.color=new cc.Color(134,131,255,255):this.bg.color=new cc.Color(62,65,126,255);var t=[500,300,200,100,50,40,30,30],a=30;e.rank<=t.length&&(a=t[e.rank-1]),this.coinLb.string=a}}),cc._RF.pop()},{}],uiDeadPanel:[function(e,t,a){"use strict";cc._RF.push(t,"8023fdKqxVOQ6zhwR3dAdte","uiDeadPanel");var i=kf.require("logic.platform"),n=kf.require("shared.constants"),s=(kf.require("basic.clientEvent"),kf.require("logic.user")),r=kf.require("basic.pool");cc.Class({extends:cc.Component,properties:{shareBtn:cc.Node,backToMainBtn:cc.Node,rankLb:cc.Label,murderLb:cc.Label,display:cc.Sprite,countDownLb:cc.Label,guessYouLike:cc.Node,recommendView:cc.Node,gameItemPrefab:cc.Prefab},onLoad:function(){var e=this.display.getComponent(cc.Widget);e&&(e.target=cc.Canvas.instance.node,e.top=0,e.bottom=0,e.left=0,e.right=0,e.updateAlignment()),this.backToMainBtn.active=!0,this.backToMainBtn.height=s.clickAreaHeight4,this.onSharing=!1},start:function(){s.underReview||window.tt?(this.shareBtn.getChildByName("layout").getChildByName("icon").active=!1,this.guessYouLike.active=!1,this.recommendView.active=!1):(s.setShareState(n.shareId.revive,this.shareBtn.getChildByName("layout").getChildByName("icon")),this.guessYouLike.active=!0,this.recommendView.active=!0),this.recommendView.active=!1,i.showBannerAd(n.adPlaceName.dailyWelfarePanel),window.wx&&wx.aldSendEvent("\u590d\u6d3b\u754c\u9762");var e=9;this.countDownLb.string=e,this.countDownId=setInterval(function(){this.onSharing&&!window.tt||(--e<0?PlayerManager.player&&!PlayerManager.player.node.active&&(i.hideBannerAd(),i.showBannerAd(n.adPlaceName.uiGamePanel),this.node.destroy(),PlayerManager.player.reviveNormal()):this.countDownLb.string=e)}.bind(this),1e3);var t=this;this.shareBtn.on("click",function(){if(this.onSharing=!0,window.wx)wx.aldSendEvent("Y\u590d\u6d3b\u6309\u94ae"),i.shareAppMessage({title:"\u5206\u4eab\u590d\u6d3b"},function(){PlayerManager.player&&GameManager.gameState!==GameState.TimeOver&&(PlayerManager.player.reviveDouble(),i.hideBannerAd(),i.showBannerAd(n.adPlaceName.uiGamePanel),GameManager.gameState=GameState.Play),t.isValid&&t.node.destroy()},function(){t.onSharing=!1,wx.showToast({title:"\u8f6c\u53d1\u5931\u8d25",icon:"none",duration:1500})},n.shareId.revive);else{if(this.onSharing=!1,PlayerManager.player&&GameManager.gameState!==GameState.TimeOver&&(PlayerManager.player.reviveDouble(),GameManager.gameState=GameState.Play),!this.isValid)return;this.node.destroy()}}.bind(this)),this.backToMainBtn.on("click",function(){window.wx&&wx.aldSendEvent("\u70b9\u51fb\u590d\u6d3b\u754c\u9762-\u8df3\u8fc7\u6309\u94ae"),window.tt&&s.recording&&(s.recording=!1,i.getGameRecorder(!1)),GameManager.AILevelDown(),cc.director.loadScene("loginScene")}.bind(this)),this.murderLb.string=PlayerManager.player.murder.playerName,this.murderLb.node.color=PlayerManager.player.murder.uiColor,PlayerManager.players.sort(function(e,t){return t.fans.length-e.fans.length});var a=PlayerManager.players.indexOf(PlayerManager.player);this.rankLb.string="."+(a+1),this.setGuessYouLike()},showRecommendView:function(){s.underReview||window.tt||(r.createPrefabPool(this.gameItemPrefab),s.getChannelData(n.channelLocation.hutuiqiang,function(e){this.gameData=e,this.itemArr=[],this.initItems()}.bind(this)))},initItems:function(){if(this.isValid)for(var e=0;e<this.gameData.length;e++){if(e>5)return;var t=r.getPrefab(this.gameItemPrefab.name);if(t.getChildByName("label").getComponent(cc.Label).string=this.gameData[e].name,1===this.gameData[e].logo_status){var a=this.gameData[e].logo;(function(e){s.headImage(a,e.getChildByName("image"))})(t)}else for(var i=0;i<GameManager.appIcons.length;i++)if(GameManager.appIcons[i].name===this.gameData[e].client_logo){t.getChildByName("image").getComponent(cc.Sprite).spriteFrame=GameManager.appIcons[i];break}t.getChildByName("redDot").active=this.gameData[e].redPoint,this.recommendView.getChildByName("layout").addChild(t),this.itemArr.push(t),function(e){t.on("click",function(){var t=this;if(console.log("\u70b9\u51fb\u4e86"+e),this.gameId=this.gameData[e].id,this.gameId){s.sixGameDotState["g"+this.gameId]=!1;var a=this.itemArr[e];a.getChildByName("redDot").active=this.gameData[e].redPoint&&!!s.sixGameDotState["g"+this.gameId],setTimeout(function(){t.isValid&&(s.sixGameDotState["g"+t.gameId]=!0,t.node&&t.node.active&&(a.getChildByName("redDot").active=t.gameData[e].redPoint&&!!s.sixGameDotState["g"+t.gameId]))},45e3)}window.wx&&(this.gameId=this.gameData[e].id,wx.aldSendEvent("\u5356\u91cf-\u590d\u6d3b\u754c\u9762-\u516d\u5bab\u683c"),wx.aldSendEvent("\u5356\u91cf-"+this.gameData[e].name),wx.navigateToMiniProgram({appId:this.gameData[e].appid,path:this.gameData[e].path||"",success:function(e){s.reportChannelData(this.gameId)}.bind(this)}))}.bind(this))}.bind(this)(e)}},setGuessYouLike:function(){s.underReview||window.tt||(this.gameData?this.setScrollViewData():s.getChannelData(n.channelLocation.cainixihuan,function(e){this.isValid&&(this.gameData=e,this.setScrollViewData())}.bind(this)))},setScrollViewData:function(){this.guessYouLike.getChildByName("scrollView1").getComponent("reuseScrollView").setData(this.gameData.slice(0,5)),this.guessYouLike.getChildByName("scrollView2").getComponent("reuseScrollView").setData(this.gameData.slice(5,this.gameData.length))},onDestroy:function(){clearInterval(this.countDownId)}}),cc._RF.pop()},{}],uiKillRank:[function(e,t,a){"use strict";cc._RF.push(t,"a9e6fl+C21Oi5/CB5u8nBQb","uiKillRank");var i=e("rankDetail"),n=kf.require("basic.clientEvent");cc.Class({extends:cc.Component,properties:{rankDetails:[i],selfRankDetail:i},onLoad:function(){n.on("addFan",this.addFan.bind(this))},addFan:function(){if(this.rankDetails){PlayerManager.players.sort(function(e,t){return t.fans.length-e.fans.length});for(var e=0;e<PlayerManager.players.length&&e<this.rankDetails.length;e++){var t=PlayerManager.players[e];if(t){var a={rank:e+1,fansCnt:t.fans.length,playerName:t.playerName,color:t.uiColor};this.rankDetails[e].setData(a)}}var i={rank:PlayerManager.players.indexOf(PlayerManager.player)+1,fansCnt:PlayerManager.player.fans.length,playerName:PlayerManager.player.playerName,color:PlayerManager.player.uiColor,isMainPlayer:!0};this.selfRankDetail.setData(i)}},onDestroy:function(){n.off("addFan",this.addFan.bind(this))}}),cc._RF.pop()},{rankDetail:"rankDetail"}],uiTimeOver:[function(e,t,a){"use strict";cc._RF.push(t,"db2c1+M3UhP3qQ9rIjybBkQ","uiTimeOver");var i=kf.require("logic.platform"),n=kf.require("shared.constants"),s=kf.require("logic.user"),r=kf.require("component.panel");cc.Class({extends:r,properties:{backToMainBtn:cc.Node,rankPrefab:cc.Prefab,layoutParent:cc.Node,shareBtn:cc.Node,otherBtn1:cc.Node,otherBtn2:cc.Node,image1:cc.Node,image2:cc.Node,nameLb1:cc.Label,nameLb2:cc.Label},setData:function(e){this.screenShootPath=e,console.log("screenShootPath :"+e)},update:function(e){this.showMoreCurCd-=e,this.showMoreCurCd<0&&this.showMoreOtherGame()},showMoreOtherGame:function(){this.showMoreCurCd=this.showMoreMaxCd,this.randomIndex1+=2,this.randomIndex1>=s.otherGameData.length&&(this.randomIndex1=0),this.showOtherGameBtn(this.image1,this.nameLb1,this.randomIndex1),this.randomIndex2+=2,this.randomIndex2>=s.otherGameData.length&&(this.randomIndex2=1),this.showOtherGameBtn(this.image2,this.nameLb2,this.randomIndex2)},start:function(){var e=this,t=kf.require("logic.user");window.wx&&(wx.aldSendEvent("\u70ab\u8000\u754c\u9762"),dataFunc.isInSameDay(t.data.user.regtime)&&wx.aldSendEvent("\u9996\u65e5\u6e38\u620f\u7ed3\u675f\uff1a"+t.data.user.channel)),this.randomIndex1=0,this.randomIndex2=1,this.showMoreMaxCd=3,this.showMoreCurCd=this.showMoreMaxCd,i.hideBannerAd(),t.setAudio("timeOver"),this.backToMainBtn.height=t.clickAreaHeight4,this.backToMainBtn.on("click",function(){cc.director.loadScene("loginScene")}),PlayerManager.players&&(PlayerManager.players.sort(function(e,t){return t.fans.length-e.fans.length}),i.hideBannerAd(n.adPlaceName.uiTimeOver));for(var a=1,s=function(t){var i=cc.instantiate(e.rankPrefab);i.parent=e.layoutParent;var n=i.getComponent("timeOverRankDetail"),s=PlayerManager.players[t];if(s){var r={rank:t+1,fansCnt:s.fans.length,playerName:s.playerName,color:s.uiColor,isSelf:s===PlayerManager.player};n.setData(r),r.isSelf&&(a=r.rank)}var o=i.getComponent(cc.Animation);o&&setTimeout(function(){o.isValid&&o.play()},100*t)},r=0;PlayerManager.players&&r<PlayerManager.players.length;r++)s(r);var o="\u6211\u5728\u57ce\u5e02\u5927\u4f5c\u6218\u4e2d\u83b7\u5f97\u4e86"+PlayerManager.player.getFansAmount()+"\u4e2a\u7c89\u4e1d\uff0c\u6392\u540d\u7b2c"+a+"\uff0c\u523a\u6fc0\u5230\u4e0d\u884c\uff01";this.shareBtn.on("click",function(){if(window.wx&&wx.aldSendEvent("Y\u70ab\u8000\u6309\u94ae"),GameManager.SystemInfo&&GameManager.SystemInfo.brand)for(var e=["HONOR","HUAWEI"],t=0;t<e.length;t++)if(GameManager.SystemInfo.brand.indexOf(e[t])>=0){this.screenShootPath=null;break}i.shareAppMessage({title:o,imageUrl:this.screenShootPath},function(){!window.tt&&window.wx&&wx.showToast({title:"\u6210\u529f\u53d1\u9001\u7ed9\u597d\u53cb",icon:"none",duration:1500})},null,n.shareId.shareToFriend,!0)}.bind(this)),this.showMoreOtherGame(),window.tt&&(this.otherBtn1.active=!1,this.otherBtn2.active=!1),this.otherBtn1.on("click",function(){t.setAudio("btnClick"),this.navigateToMiniProgram(this.randomIndex1),console.log("open game:"+t.otherGameData[this.randomIndex1].name),this.showMoreOtherGame()}.bind(this)),this.otherBtn2.on("click",function(){t.setAudio("btnClick"),this.navigateToMiniProgram(this.randomIndex2),console.log("open game:"+t.otherGameData[this.randomIndex2].name),this.showMoreOtherGame()}.bind(this)),i.hideBannerAd(),i.showBannerAd(n.adPlaceName.uiTimeOver),t.underReview&&(this.otherBtn1.active=!1,this.otherBtn2.active=!1),window.tt&&t.recording&&(t.recording=!1,i.getGameRecorder(!1))},navigateToMiniProgram:function(e){window.wx&&(this.gameId=s.otherGameData[e].id,console.log("#######"+this.gameId),wx.aldSendEvent("\u5356\u91cf-\u65f6\u95f4\u5230-\u8f6e\u64ad"),wx.aldSendEvent("\u5356\u91cf-"+s.otherGameData[e].name),wx.navigateToMiniProgram({appId:s.otherGameData[e].appid,path:s.otherGameData[e].path,success:function(e){s.reportChannelData(this.gameId)}.bind(this)}))},showOtherGameBtn:function(e,t,a){var i=s.otherGameData[a];if(1===i.logo_status)s.headImage(i.logo,e);else for(var n=0;n<GameManager.appIcons.length;n++)if(GameManager.appIcons[n].name===i.client_logo){e.getComponent(cc.Sprite).spriteFrame=GameManager.appIcons[n];break}t.string=i.name}}),cc._RF.pop()},{}]},{},["CircleCheck","Follow","Player","Shadow","enemyPosArrow","enemyPosName","fan","Game","JoystickBG","JoystickCommon","CircleManager","FansManager","ObstaclesManager","PlayerManager","ShadowManager","UIGamePanel","killTip","rankDetail","timeOverRankDetail","uiDeadPanel","uiKillRank","uiTimeOver"]);